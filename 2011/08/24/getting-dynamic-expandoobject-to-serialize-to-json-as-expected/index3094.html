<!DOCTYPE html>
<html lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
<meta name="viewport" content="width=device-width, user-scalable=yes, initial-scale=1.0, minimum-scale=1.0, maximum-scale=3.0">
<link rel="apple-touch-icon" href="../../../../wp-content/themes/mantra_custom/images/favicon/apple-touch-icon.html" />
<link rel="profile" href="http://gmpg.org/xfn/11" />
<link rel="pingback" href="../../../../xmlrpc.php" />
<title>Getting dynamic ExpandoObject to serialize to JSON as expected &#8211; PatridgeDev</title>
<link rel='dns-prefetch' href='http://fonts.googleapis.com/' />
<link rel='dns-prefetch' href='http://s.w.org/' />
<link rel="alternate" type="application/rss+xml" title="PatridgeDev &raquo; Feed" href="../../../../feed/index.html" />
<link rel="alternate" type="application/rss+xml" title="PatridgeDev &raquo; Comments Feed" href="../../../../comments/feed/index.html" />
<link rel="alternate" type="application/rss+xml" title="PatridgeDev &raquo; Getting dynamic ExpandoObject to serialize to JSON as expected Comments Feed" href="feed/index.html" />
		<!-- This site uses the Google Analytics by MonsterInsights plugin v8.5.2 - Using Analytics tracking - https://www.monsterinsights.com/ -->
							<script src="http://www.googletagmanager.com/gtag/js?id=UA-24616833-1"  data-cfasync="false" data-wpfc-render="false" type="text/javascript" async></script>
			<script data-cfasync="false" data-wpfc-render="false" type="text/javascript">
				var mi_version = '8.5.2';
				var mi_track_user = true;
				var mi_no_track_reason = '';
				
								var disableStrs = [
										'ga-disable-G-3WN7RP75N7',
															'ga-disable-UA-24616833-1',
									];

				/* Function to detect opted out users */
				function __gtagTrackerIsOptedOut() {
					for ( var index = 0; index < disableStrs.length; index++ ) {
						if ( document.cookie.indexOf( disableStrs[ index ] + '=true' ) > -1 ) {
							return true;
						}
					}

					return false;
				}

				/* Disable tracking if the opt-out cookie exists. */
				if ( __gtagTrackerIsOptedOut() ) {
					for ( var index = 0; index < disableStrs.length; index++ ) {
						window[ disableStrs[ index ] ] = true;
					}
				}

				/* Opt-out function */
				function __gtagTrackerOptout() {
					for ( var index = 0; index < disableStrs.length; index++ ) {
						document.cookie = disableStrs[ index ] + '=true; expires=Thu, 31 Dec 2099 23:59:59 UTC; path=/';
						window[ disableStrs[ index ] ] = true;
					}
				}

				if ( 'undefined' === typeof gaOptout ) {
					function gaOptout() {
						__gtagTrackerOptout();
					}
				}
								window.dataLayer = window.dataLayer || [];

				window.MonsterInsightsDualTracker = {
					helpers: {},
					trackers: {},
				};
				if ( mi_track_user ) {
					function __gtagDataLayer() {
						dataLayer.push( arguments );
					}

					function __gtagTracker( type, name, parameters ) {
						if (!parameters) {
							parameters = {};
						}

						if (parameters.send_to) {
							__gtagDataLayer.apply( null, arguments );
							return;
						}

						if ( type === 'event' ) {
															parameters.send_to = monsterinsights_frontend.v4_id;
								var hookName = name;
								if ( typeof parameters[ 'event_category' ] !== 'undefined' ) {
									hookName = parameters[ 'event_category' ] + ':' + name;
								}

								if ( typeof MonsterInsightsDualTracker.trackers[ hookName ] !== 'undefined' ) {
									MonsterInsightsDualTracker.trackers[ hookName ]( parameters );
								} else {
									__gtagDataLayer( 'event', name, parameters );
								}
							
															parameters.send_to = monsterinsights_frontend.ua;
								__gtagDataLayer( type, name, parameters );
													} else {
							__gtagDataLayer.apply( null, arguments );
						}
					}
					__gtagTracker( 'js', new Date() );
					__gtagTracker( 'set', {
						'developer_id.dZGIzZG' : true,
											} );
										__gtagTracker( 'config', 'G-3WN7RP75N7', {"forceSSL":"true","link_attribution":"true"} );
															__gtagTracker( 'config', 'UA-24616833-1', {"forceSSL":"true","link_attribution":"true"} );
										window.gtag = __gtagTracker;											(function () {
							/* https://developers.google.com/analytics/devguides/collection/analyticsjs/ */
							/* ga and __gaTracker compatibility shim. */
							var noopfn = function () {
								return null;
							};
							var newtracker = function () {
								return new Tracker();
							};
							var Tracker = function () {
								return null;
							};
							var p = Tracker.prototype;
							p.get = noopfn;
							p.set = noopfn;
							p.send = function (){
								var args = Array.prototype.slice.call(arguments);
								args.unshift( 'send' );
								__gaTracker.apply(null, args);
							};
							var __gaTracker = function () {
								var len = arguments.length;
								if ( len === 0 ) {
									return;
								}
								var f = arguments[len - 1];
								if ( typeof f !== 'object' || f === null || typeof f.hitCallback !== 'function' ) {
									if ( 'send' === arguments[0] ) {
										var hitConverted, hitObject = false, action;
										if ( 'event' === arguments[1] ) {
											if ( 'undefined' !== typeof arguments[3] ) {
												hitObject = {
													'eventAction': arguments[3],
													'eventCategory': arguments[2],
													'eventLabel': arguments[4],
													'value': arguments[5] ? arguments[5] : 1,
												}
											}
										}
										if ( 'pageview' === arguments[1] ) {
											if ( 'undefined' !== typeof arguments[2] ) {
												hitObject = {
													'eventAction': 'page_view',
													'page_path' : arguments[2],
												}
											}
										}
										if ( typeof arguments[2] === 'object' ) {
											hitObject = arguments[2];
										}
										if ( typeof arguments[5] === 'object' ) {
											Object.assign( hitObject, arguments[5] );
										}
										if ( 'undefined' !== typeof arguments[1].hitType ) {
											hitObject = arguments[1];
											if ( 'pageview' === hitObject.hitType ) {
												hitObject.eventAction = 'page_view';
											}
										}
										if ( hitObject ) {
											action = 'timing' === arguments[1].hitType ? 'timing_complete' : hitObject.eventAction;
											hitConverted = mapArgs( hitObject );
											__gtagTracker( 'event', action, hitConverted );
										}
									}
									return;
								}

								function mapArgs( args ) {
									var arg, hit = {};
									var gaMap = {
										'eventCategory': 'event_category',
										'eventAction': 'event_action',
										'eventLabel': 'event_label',
										'eventValue': 'event_value',
										'nonInteraction': 'non_interaction',
										'timingCategory': 'event_category',
										'timingVar': 'name',
										'timingValue': 'value',
										'timingLabel': 'event_label',
										'page' : 'page_path',
										'location' : 'page_location',
										'title' : 'page_title',
									};
									for ( arg in args ) {
																				if ( ! ( ! args.hasOwnProperty(arg) || ! gaMap.hasOwnProperty(arg) ) ) {
											hit[gaMap[arg]] = args[arg];
										} else {
											hit[arg] = args[arg];
										}
									}
									return hit;
								}

								try {
									f.hitCallback();
								} catch ( ex ) {
								}
							};
							__gaTracker.create = newtracker;
							__gaTracker.getByName = newtracker;
							__gaTracker.getAll = function () {
								return [];
							};
							__gaTracker.remove = noopfn;
							__gaTracker.loaded = true;
							window['__gaTracker'] = __gaTracker;
						})();
									} else {
										console.log( "" );
					( function () {
							function __gtagTracker() {
								return null;
							}
							window['__gtagTracker'] = __gtagTracker;
							window['gtag'] = __gtagTracker;
					} )();
									}
			</script>
				<!-- / Google Analytics by MonsterInsights -->
				<script type="text/javascript">
			window._wpemojiSettings = {"baseUrl":"https:\/\/s.w.org\/images\/core\/emoji\/12.0.0-1\/72x72\/","ext":".png","svgUrl":"https:\/\/s.w.org\/images\/core\/emoji\/12.0.0-1\/svg\/","svgExt":".svg","source":{"concatemoji":"https:\/\/www.patridgedev.com\/wp-includes\/js\/wp-emoji-release.min.js?ver=5.4.11"}};
			/*! This file is auto-generated */
			!function(e,a,t){var n,r,o,i=a.createElement("canvas"),p=i.getContext&&i.getContext("2d");function s(e,t){var a=String.fromCharCode;p.clearRect(0,0,i.width,i.height),p.fillText(a.apply(this,e),0,0);e=i.toDataURL();return p.clearRect(0,0,i.width,i.height),p.fillText(a.apply(this,t),0,0),e===i.toDataURL()}function c(e){var t=a.createElement("script");t.src=e,t.defer=t.type="text/javascript",a.getElementsByTagName("head")[0].appendChild(t)}for(o=Array("flag","emoji"),t.supports={everything:!0,everythingExceptFlag:!0},r=0;r<o.length;r++)t.supports[o[r]]=function(e){if(!p||!p.fillText)return!1;switch(p.textBaseline="top",p.font="600 32px Arial",e){case"flag":return s([127987,65039,8205,9895,65039],[127987,65039,8203,9895,65039])?!1:!s([55356,56826,55356,56819],[55356,56826,8203,55356,56819])&&!s([55356,57332,56128,56423,56128,56418,56128,56421,56128,56430,56128,56423,56128,56447],[55356,57332,8203,56128,56423,8203,56128,56418,8203,56128,56421,8203,56128,56430,8203,56128,56423,8203,56128,56447]);case"emoji":return!s([55357,56424,55356,57342,8205,55358,56605,8205,55357,56424,55356,57340],[55357,56424,55356,57342,8203,55358,56605,8203,55357,56424,55356,57340])}return!1}(o[r]),t.supports.everything=t.supports.everything&&t.supports[o[r]],"flag"!==o[r]&&(t.supports.everythingExceptFlag=t.supports.everythingExceptFlag&&t.supports[o[r]]);t.supports.everythingExceptFlag=t.supports.everythingExceptFlag&&!t.supports.flag,t.DOMReady=!1,t.readyCallback=function(){t.DOMReady=!0},t.supports.everything||(n=function(){t.readyCallback()},a.addEventListener?(a.addEventListener("DOMContentLoaded",n,!1),e.addEventListener("load",n,!1)):(e.attachEvent("onload",n),a.attachEvent("onreadystatechange",function(){"complete"===a.readyState&&t.readyCallback()})),(n=t.source||{}).concatemoji?c(n.concatemoji):n.wpemoji&&n.twemoji&&(c(n.twemoji),c(n.wpemoji)))}(window,document,window._wpemojiSettings);
		</script>
		<style type="text/css">
img.wp-smiley,
img.emoji {
	display: inline !important;
	border: none !important;
	box-shadow: none !important;
	height: 1em !important;
	width: 1em !important;
	margin: 0 .07em !important;
	vertical-align: -0.1em !important;
	background: none !important;
	padding: 0 !important;
}
</style>
	<link rel='stylesheet' id='wp-block-library-css'  href='../../../../wp-includes/css/dist/block-library/style.mine6b3.css?ver=5.4.11' type='text/css' media='all' />
<link rel='stylesheet' id='mantra-style-css'  href='../../../../wp-content/themes/mantra.3.2.0_custom/style55a0.css?ver=3.2.0' type='text/css' media='all' />
<style id='mantra-style-inline-css' type='text/css'>
 #wrapper { max-width: 1140px; } #content { width: 100%; max-width:800px; max-width: calc( 100% - 340px ); } #primary, #secondary { width:340px; } #primary .widget-title, #secondary .widget-title { margin-right: -2em; text-align: left; } html { font-size:15px; } body, input, textarea {font-family:"Open Sans"; } #content h1.entry-title a, #content h2.entry-title a, #content h1.entry-title, #content h2.entry-title, #front-text1 h2, #front-text2 h2 {font-family: "Merriweather"; } .widget-area {font-family:"Open Sans"; } .entry-content h1, .entry-content h2, .entry-content h3, .entry-content h4, .entry-content h5, .entry-content h6 {font-family:"Merriweather"; } .nocomments, .nocomments2 {display:none;} #header-container > div { margin-top:30px; } #header-container > div { margin-left:30px; } body { background-color:#444444 !important; } #header { background-color:#333333; } #footer { background-color:#222222; } #footer2 { background-color:#171717; } #site-title span a { color:#0D85CC; } #site-description { color:#999999; } #content { color:#555555 ;} .widget-area a:link, .widget-area a:visited, a:link, a:visited ,#searchform #s:hover, #container #s:hover, #access a:hover, #wp-calendar tbody td a, #site-info a, #site-copyright a, #access li:hover > a, #access ul ul:hover > a { color:#0D85CC; } a:hover, .entry-meta a:hover, .entry-utility a:hover, .widget-area a:hover { color:#12a7ff; } #content .entry-title a, #content .entry-title, #content h1, #content h2, #content h3, #content h4, #content h5, #content h6 { color:#444444; } #content .entry-title a:hover { color:#000000; } .widget-title { background-color:#444444; } .widget-title { color:#FFFFFF; } #footer-widget-area .widget-title { color:#FFFFFF; } #footer-widget-area a { color:#666666; } #footer-widget-area a:hover { color:#888888; } .png); } .entry-content p:not(:last-child), .entry-content ul, .entry-summary ul, .entry-content ol, .entry-summary ol { margin-bottom:1.5em;} .entry-meta .entry-time { display:none; } #branding { height:125px ;} 
/* Mantra Custom CSS */
</style>
<link rel='stylesheet' id='mantra-googlefont-css'  href='http://fonts.googleapis.com/css?family=Open+Sans%3A400%2C700&amp;ver=5.4.11' type='text/css' media='all' />
<link rel='stylesheet' id='mantra-googlefont-title-css'  href='http://fonts.googleapis.com/css?family=Merriweather%3A400%2C700&amp;ver=5.4.11' type='text/css' media='all' />
<link rel='stylesheet' id='mantra-googlefont-side-css'  href='http://fonts.googleapis.com/css?family=Open+Sans%3A400%2C700&amp;ver=5.4.11' type='text/css' media='all' />
<link rel='stylesheet' id='mantra-googlefont-headings-css'  href='http://fonts.googleapis.com/css?family=Merriweather%3A400%2C700&amp;ver=5.4.11' type='text/css' media='all' />
<link rel='stylesheet' id='mantra-mobile-css'  href='../../../../wp-content/themes/mantra.3.2.0_custom/resources/css/style-mobile55a0.css?ver=3.2.0' type='text/css' media='all' />
<script type='text/javascript' src='../../../../wp-content/plugins/google-analytics-for-wordpress/assets/js/frontend-gtag.min8833.js?ver=8.5.2'></script>
<script data-cfasync="false" data-wpfc-render="false" type="text/javascript" id='monsterinsights-frontend-script-js-extra'>/* <![CDATA[ */
var monsterinsights_frontend = {"js_events_tracking":"true","download_extensions":"doc,pdf,ppt,zip,xls,docx,pptx,xlsx","inbound_paths":"[{\"path\":\"\\\/go\\\/\",\"label\":\"affiliate\"},{\"path\":\"\\\/recommend\\\/\",\"label\":\"affiliate\"}]","home_url":"https:\/\/www.patridgedev.com","hash_tracking":"false","ua":"UA-24616833-1","v4_id":"G-3WN7RP75N7"};/* ]]> */
</script>
<script type='text/javascript' src='../../../../wp-includes/js/jquery/jquery4a5f.js?ver=1.12.4-wp'></script>
<script type='text/javascript' src='../../../../wp-includes/js/jquery/jquery-migrate.min330a.js?ver=1.4.1'></script>
<script type='text/javascript'>
/* <![CDATA[ */
var mantra_options = {"responsive":"1","image_class":"imageNone","equalize_sidebars":"0"};
/* ]]> */
</script>
<script type='text/javascript' src='../../../../wp-content/themes/mantra.3.2.0_custom/resources/js/frontend55a0.js?ver=3.2.0'></script>
<link rel='https://api.w.org/' href='../../../../wp-json/index.html' />
<link rel="EditURI" type="application/rsd+xml" title="RSD" href="../../../../xmlrpc0db0.php?rsd" />
<link rel="wlwmanifest" type="application/wlwmanifest+xml" href="../../../../wp-includes/wlwmanifest.xml" /> 
<link rel='prev' title='Subtleties with using Url.RouteUrl to get fully-qualified URLs' href='../../22/subtleties-with-using-url-routeurl-to-get-fully-qualified-urls/index.html' />
<link rel='next' title='Adapting Visual Studio code styling differences for open source project contribution' href='../../../12/01/adapting-visual-studio-code-styling-differences-for-open-source-project-contribution/index.html' />
<meta name="generator" content="WordPress 5.4.11" />
<link rel="canonical" href="index.html" />
<link rel='shortlink' href='../../../../index94b0.html?p=48' />
<meta name='robots' content='noindex,follow' />
<link rel="alternate" type="application/json+oembed" href="../../../../wp-json/oembed/1.0/embedeb4f.json?url=https%3A%2F%2Fwww.patridgedev.com%2F2011%2F08%2F24%2Fgetting-dynamic-expandoobject-to-serialize-to-json-as-expected%2F" />
<link rel="alternate" type="text/xml+oembed" href="../../../../wp-json/oembed/1.0/embed4dcc?url=https%3A%2F%2Fwww.patridgedev.com%2F2011%2F08%2F24%2Fgetting-dynamic-expandoobject-to-serialize-to-json-as-expected%2F&amp;format=xml" />
<!--[if lte IE 8]> <style type="text/css" media="screen"> #access ul li, .edit-link a , #footer-widget-area .widget-title, .entry-meta,.entry-meta .comments-link, .short-button-light, .short-button-dark ,.short-button-color ,blockquote { position:relative; behavior: url(/wp-content/themes/mantra.3.2.0_custom/resources/js/PIE/PIE.php); } #access ul ul { -pie-box-shadow:0px 5px 5px #999; } #access ul li.current_page_item, #access ul li.current-menu-item , #access ul li ,#access ul ul ,#access ul ul li, .commentlist li.comment ,.commentlist .avatar, .nivo-caption, .theme-default .nivoSlider { behavior: url(/wp-content/themes/mantra.3.2.0_custom/resources/js/PIE/PIE.php); } </style> <![endif]--><!--[if lt IE 9]> 
	<script>
	document.createElement('header');
	document.createElement('nav');
	document.createElement('section');
	document.createElement('article');
	document.createElement('aside');
	document.createElement('footer');
	document.createElement('hgroup');
	</script>
	<![endif]--> 		<style type="text/css" id="wp-custom-css">
			#site-description { text-transform: none; }		</style>
			<link href="https://plus.google.com/103902189108210179119" rel="author" />
</head>
<body class="post-template-default single single-post postid-48 single-format-standard mantra-image-none mantra-caption-light mantra-hratio-0 mantra-sidebar-right mantra-menu-left">

    <div id="toTop"><i class="crycon-back2top"></i> </div>
	
<div id="wrapper" class="hfeed">


<header id="header">

		<div id="masthead">

			<div id="branding" role="banner" >

					
	<div id="header-container">
	
				<div>
				<div id="site-title">
					<span> <a href="../../../../index.html" title="PatridgeDev" rel="home">PatridgeDev</a> </span>
				</div>
				<div id="site-description" >Software developer obsessed with helping others do more with training, tooling, and automation.</div>
			</div> 	<div class="socials" id="sheader"> 
	
			<a target="_blank" rel="nofollow" href="https://twitter.com/patridgedev" class="socialicons social-Twitter" title="Twitter">
				<img alt="Twitter" src="../../../../wp-content/themes/mantra.3.2.0_custom/resources/images/socials/Twitter.png" />
			</a>
            	</div>
		</div> <!-- #header-container -->
					<div style="clear:both;"></div>

			</div><!-- #branding -->

            <a id="nav-toggle"><span>&nbsp; Menu</span></a>
			<nav id="access" class="jssafe" role="navigation">

					<div class="skip-link screen-reader-text"><a href="#content" title="Skip to content">Skip to content</a></div>
	<div id="prime_nav" class="menu"><ul>
<li ><a href="../../../../index.html">Home</a></li><li class="page_item page-item-6"><a href="../../../../about-me/index.html">About Me</a></li>
<li class="page_item page-item-321 page_item_has_children"><a href="../../../../smudges/index.html">Smudges</a>
<ul class='children'>
	<li class="page_item page-item-336"><a href="../../../../smudges/smudges-privacy-policy/index.html">Smudges Privacy Policy</a></li>
</ul>
</li>
</ul></div>

			</nav><!-- #access -->

		</div><!-- #masthead -->

	<div style="clear:both;"> </div>

</header><!-- #header -->
<div id="main" class="main">
	<div  id="forbottom" >
			<div class="socials" id="smenur"> 
	
			<a target="_blank" rel="nofollow" href="https://twitter.com/patridgedev" class="socialicons social-Twitter" title="Twitter">
				<img alt="Twitter" src="../../../../wp-content/themes/mantra.3.2.0_custom/resources/images/socials/Twitter.png" />
			</a>
            	</div>
	
		<div style="clear:both;"> </div>

		
		<section id="container">
			<div id="content" role="main">

			

				<div id="nav-above" class="navigation">
					<div class="nav-previous"><a href="../../22/subtleties-with-using-url-routeurl-to-get-fully-qualified-urls/index.html" rel="prev"><span class="meta-nav">&laquo;</span> Subtleties with using Url.RouteUrl to get fully-qualified URLs</a></div>
					<div class="nav-next"><a href="../../../12/01/adapting-visual-studio-code-styling-differences-for-open-source-project-contribution/index.html" rel="next">Adapting Visual Studio code styling differences for open source project contribution <span class="meta-nav">&raquo;</span></a></div>
				</div><!-- #nav-above -->

				<article id="post-48" class="post-48 post type-post status-publish format-standard hentry category-dev tag-c-sharp tag-javascriptserializer tag-json tag-json-net tag-servicestack-text">
					<h1 class="entry-title">Getting dynamic ExpandoObject to serialize to JSON as expected</h1>
										<div class="entry-meta">
						 <span class="author vcard" > By  <a class="url fn n" rel="author" href="../../../../author/adam/index.html" title="View all posts by adam">adam</a> <span class="bl_sep">|</span></span>  <time class="onDate date published" datetime="2011-08-24T20:44:18+00:00"> <a href="index.html" title="8:44 pm" rel="bookmark"><span class="entry-date">August 24, 2011</span> <span class="entry-time"> - 8:44 pm</span></a> </time><span class="bl_sep">|</span><time class="updated"  datetime="2011-08-24T20:44:18+00:00">August 24, 2011</time> <span class="bl_categ"> <a href="../../../../category/dev/index.html" rel="tag">dev</a> </span>  					</div><!-- .entry-meta -->

					<div class="entry-content">
						<h2>Serializing ExpandoObjects</h2>

<p>I am currently creating a JSON API for a handful of upcoming Sierra Trading Post projects. When I found myself generating JSON for a stripped-down representation of a number of domain classes, all wrapped with some metadata, I turned to <code>dynamic</code> and things have been going quite well. Unfortunately, there was a hurdle to getting the JSON to look the way I wanted.</p>

<p>If you start playing around with serializing <code>ExpandoObject</code> to JSON, you will probably start finding a number of options. The easiest solution to find is the one that <a href="http://msdn.microsoft.com/en-us/library/bb302399.aspx">comes with .NET</a>, <code>JavaScriptSerializer</code> under <code>System.Web.Script.Serialization</code>. It will happily serialize an <code>ExpandoObject</code> for you, but it probably won&#8217;t look the way you expect. Your searches will probably vary, but I found Newtonsoft&#8217;s JSON.NET, which handled <code>ExpandoObject</code> right out of the <a href="http://nuget.org/List/Packages/Newtonsoft.Json">NuGet box</a>. Then I stumbled on <a href="https://github.com/ServiceStack/ServiceStack.Text">ServiceStack.Text</a> (also <a href="http://nuget.org/List/Packages/ServiceStack.Text">&#8220;NuGettable&#8221;</a>). While it does even weirder things than the .NET serializer with <code>ExpandoObject</code>s, it supposedly does them very fast.</p>

<h3>Test code</h3>

<pre><code>dynamic test = new ExpandoObject();
test.x = "xvalue";
test.y = DateTime.Now;
</code></pre>

<h3>BCL JavaScriptSerializer (<code>using System.Web.Script.Serialization;</code>)</h3>

<pre><code>JavaScriptSerializer javaScriptSerializer = new JavaScriptSerializer();
string jsonOfTest = javaScriptSerializer.Serialize(test);
// [{"Key":"x","Value":"xvalue"},{"Key":"y","Value":"\/Date(1314108923000)\/"}]
</code></pre>

<p>Not quite what I was looking for but it makes sense if you realize that <code>ExpandoObject</code> plays very nicely with <code>IDictionary&lt;string, object&gt;</code>. By using <a href="http://stackoverflow.com/questions/5156664/how-to-flatten-an-expandoobject-returned-via-jsonresult-in-asp-net-mvc/5913094#5913094">some code borrowed from StackOverflow</a> (not the accepted answer, but I like it) and <a href="http://theburningmonk.com/2011/05/idictionarystring-object-to-expandoobject-extension-method/">theburningmonk.com</a>, you put together a custom serializer for <code>ExpandoObject</code> and you can get something more typical of what went into assembling the object.</p>

<pre><code>/// &lt;summary&gt;
/// Allows JSON serialization of Expando objects into expected results (e.g., "x: 1, y: 2") instead of the default dictionary serialization.
/// &lt;/summary&gt;
public class ExpandoJsonConverter : JavaScriptConverter {
    public override object Deserialize(IDictionary&lt;string, object&gt; dictionary, Type type, JavaScriptSerializer serializer) {
        // See source code link for this extension method at the bottom of this post (/Helpers/IDictionaryExtensions.cs)
        return dictionary.ToExpando();
    }
    public override IDictionary&lt;string, object&gt; Serialize(object obj, JavaScriptSerializer serializer) {
        var result = new Dictionary&lt;string, object&gt;();
        var dictionary = obj as IDictionary&lt;string, object&gt;;
        foreach (var item in dictionary)
            result.Add(item.Key, item.Value);
        return result;
    }
    public override IEnumerable&lt;Type&gt; SupportedTypes {
        get {
            return new ReadOnlyCollection&lt;Type&gt;(new Type[] { typeof(ExpandoObject) });
        }
    }
}

JavaScriptSerializer javaScriptSerializer = new JavaScriptSerializer();
javaScriptSerializer.RegisterConverters(new JavaScriptConverter[] { new ExpandoJsonConverter() });
jsonOfTest = javaScriptSerializer.Serialize(test);
// {"x":"xvalue","y":"\/Date(1314108923000)\/"}
</code></pre>

<h3>Newtonsoft Json.NET</h3>

<pre><code>string jsonOfTest = Newtonsoft.Json.JsonConvert.SerializeObject(test);
// {"x":"xvalue","y":"\/Date(1314108923000-0600)\/"}
</code></pre>

<p>That worked exactly as I expected. If I can get JSON.NET to work consuming JSON under MonoTouch, it will make my life quite easy; more to come on that.</p>

<h3>ServiceStack.Text</h3>

<pre><code>string jsonOfTest = JsonSerializer.SerializeToString(test);
// ["[x, xvalue]","[y, 8/23/2011 08:15:23 AM]"]
</code></pre>

<p>ServiceStack&#8217;s JSON serialization system does something similar to the .NET <code>JavaScriptSerializer</code>, but not quite the same. I haven&#8217;t spent enough time with ServiceStack to know how this syntax will work out on consumption by another deserializing system, but I suspect this may be something that only ServiceStack would handle correctly.</p>

<p>Unfortunately, the author of the project was nice enough to confirm that <a href="http://stackoverflow.com/questions/7141767/how-to-serialize-expandoobject-using-servicestack-jsonserializer">ServiceStack.Text does not currently afford the same extensibility as the .NET <code>JavaScriptSerializer</code></a> for overriding its default behavior in this situation. He did welcome a <a href="http://help.github.com/send-pull-requests/">pull request</a> which I will look into.</p>

<p>ServiceStack.Text also doesn&#8217;t appear to support deserializing into an <code>ExpandoObject</code> as this resulted in an empty object.</p>

<pre><code>dynamic testDeserialization = ServiceStack.Text.JsonSerializer.DeserializeFromString&lt;ExpandoObject&gt;(jsonOfTest);
</code></pre>

<p>I haven&#8217;t confirmed if ServiceStack.Text deserializing works under MonoTouch yet. If it does, it would be worthwhile to have it running API JSON generation as well as the client-side JSON consumption since there is <a href="http://www.servicestack.net/mythz_blog/?p=344">evidence it performs quite nicely</a>.</p>

<p><em>UPDATE</em></p>

<p>I slapped together a new MonoTouch project in MonoDevelop and tossed in ServiceStack.Text&#8217;s DLLs with a few bits of code and confirmed it works great for a deserializing JSON into a pre-defined object.</p>

<pre><code>public class TestClass {
    public int x { get; set; }
    public string x { get; set; }
}
TestClass result = ServiceStack.Text.JsonSerializer.DeserializeFromString&lt;TestClass&gt;("{\"x\":3,\"y\":\"something\"}");
Console.WriteLine("result: x={0}, y={1}", result.x, result.y);
// result: 3, something
</code></pre>

<p><em>UPDATE (2012-04-05)</em></p>

<p>I missed a blog entry on the author&#8217;s blog describing how to get Json.NET to output <a href="http://james.newtonking.com/archive/2009/02/20/good-date-times-with-json-net.aspx"><code>DateTime</code> in different ways</a>. For example, if you prefer the ISO-8601 output, you would be able to tell it to use the <code>IsoDateTimeConverter</code>. When I went to update the test project, the latest version of <a href="http://james.newtonking.com/archive/2012/03/20/json-net-4-5-release-1-iso-dates-async-metro-build.aspx">Json.NET (4.5 Release 1) now defaults to ISO-8601</a>. Since I don&#8217;t want to risk break an existing API, I tweaked the <code>DateFormatHandling</code> to make the output match the old default. Examples are hard to find since this is such a new release, so I slapped one together and <a href="https://github.com/JamesNK/Newtonsoft.Json/pull/11">submitted it to the Json.NET docs</a> (now on GitHub).</p>

<pre><code>Newtonsoft.Json.JsonSerializerSettings settingsWithMicrosoftDateFormat = new Newtonsoft.Json.JsonSerializerSettings() { DateFormatHandling = Newtonsoft.Json.DateFormatHandling.MicrosoftDateFormat };
string jsonOfTest = Newtonsoft.Json.JsonConvert.SerializeObject(test, settingsWithMicrosoftDateFormat);
// {"x":"xvalue","y":"1333640263042-0600"}
</code></pre>

<p>Unfortunately, even Json.NET 4.5 is appending a timezone offset to the <code>DateTime</code> serialization that isn&#8217;t found in the .NET implementation. I&#8217;ll look into a custom implementation of <code>DateTimeConverterBase</code> and I have posted this as a <a href="http://stackoverflow.com/questions/10033612/prevent-json-net-4-5-from-appending-timezone-offset-when-using-microsoftdateform">question on StackOverflow</a>.</p>

<h3>Additional Notes</h3>

<p>I haven&#8217;t played much with what problems may arise with the various representations of DateTime objects on the consumption side, but they definitely all handled it differently here.</p>

<h3>Source Code</h3>

<p>To get all the code in an ASP.NET MVC project (download, load solution, hit F5 [I hope]), check out <a href="https://bitbucket.org/patridge/expandoobject-json-serialization-tests">the bitbucket.org repository for this post</a>.</p>
											</div><!-- .entry-content -->

					<div class="entry-utility">
						<span class="bl_posted">Tagged <a href="../../../../tag/c-sharp/index.html" rel="tag">c#</a>, <a href="../../../../tag/javascriptserializer/index.html" rel="tag">javascriptserializer</a>, <a href="../../../../tag/json/index.html" rel="tag">json</a>, <a href="../../../../tag/json-net/index.html" rel="tag">json.net</a>, <a href="../../../../tag/servicestack-text/index.html" rel="tag">servicestack.text</a>.</span><span class="bl_bookmark"> Bookmark the  <a href="index.html" title="Permalink to Getting dynamic ExpandoObject to serialize to JSON as expected" rel="bookmark"> permalink</a>.</span>											</div><!-- .entry-utility -->
				</article><!-- #post-## -->

<script type="text/javascript"><!--
google_ad_client = "ca-pub-4444550246692905";
/* Between Posts Leaderboard */
google_ad_slot = "1716223608";
google_ad_width = 728;
google_ad_height = 90;
//-->
</script>
<script type="text/javascript"
src="http://pagead2.googlesyndication.com/pagead/show_ads.js">
</script>


				<div id="nav-below" class="navigation">
					<div class="nav-previous"><a href="../../22/subtleties-with-using-url-routeurl-to-get-fully-qualified-urls/index.html" rel="prev"><span class="meta-nav">&laquo;</span> Subtleties with using Url.RouteUrl to get fully-qualified URLs</a></div>
					<div class="nav-next"><a href="../../../12/01/adapting-visual-studio-code-styling-differences-for-open-source-project-contribution/index.html" rel="next">Adapting Visual Studio code styling differences for open source project contribution <span class="meta-nav">&raquo;</span></a></div>
				</div><!-- #nav-below -->

				
			<div id="comments">


	<h3 id="comments-title">
		3 Responses to <em>Getting dynamic ExpandoObject to serialize to JSON as expected</em>	</h3> 
	<ol class="commentlist">
			
			<li class="comment even thread-even depth-1" id="li-comment-2">
		<div id="comment-2">
		<div class="comment-author vcard">
			<img alt='' src='https://secure.gravatar.com/avatar/90551ca3e4050ba66d7aebc5fccea614?s=40&amp;d=identicon&amp;r=g' srcset='https://secure.gravatar.com/avatar/90551ca3e4050ba66d7aebc5fccea614?s=80&#038;d=identicon&#038;r=g 2x' class='avatar avatar-40 photo' height='40' width='40' /><cite class="fn">Charles Egan</cite> <span class="says">says:</span>


		</div><!-- .comment-author .vcard -->

		<div class="comment-meta commentmetadata"><a href="index.html#comment-2">
			June 14, 2012 at 11:48 am</a>		</div><!-- .comment-meta .commentmetadata -->

		<div class="comment-body">
				<p>This was exactly what I was looking for.  Thanks so much!</p>
</div>

		<div class="reply">
			<a rel='nofollow' class='comment-reply-link' href='index0e22.html?replytocom=2#respond' data-commentid="2" data-postid="48" data-belowelement="comment-2" data-respondelement="respond" aria-label='Reply to Charles Egan'>Reply</a>		</div><!-- .reply -->
	</div><!-- #comment-##  -->

	</li><!-- #comment-## -->
	<li class="comment odd alt thread-odd thread-alt depth-1" id="li-comment-3">
		<div id="comment-3">
		<div class="comment-author vcard">
			<img alt='' src='https://secure.gravatar.com/avatar/75aca620beaa792102e29aaf9da18a42?s=40&amp;d=identicon&amp;r=g' srcset='https://secure.gravatar.com/avatar/75aca620beaa792102e29aaf9da18a42?s=80&#038;d=identicon&#038;r=g 2x' class='avatar avatar-40 photo' height='40' width='40' /><cite class="fn">Jon Canning</cite> <span class="says">says:</span>


		</div><!-- .comment-author .vcard -->

		<div class="comment-meta commentmetadata"><a href="index.html#comment-3">
			July 10, 2012 at 2:32 am</a>		</div><!-- .comment-meta .commentmetadata -->

		<div class="comment-body">
				<p>Hi Adam,  I threw this together since I wanted to quickly test some APIs with dynamics and would appreciate your feedback:</p>

<p><a href="http://nuget.org/packages/cerealbox" rel="nofollow ugc">http://nuget.org/packages/cerealbox</a>
<a href="https://github.com/JonCanning/CerealBox" rel="nofollow ugc">https://github.com/JonCanning/CerealBox</a></p>
</div>

		<div class="reply">
			<a rel='nofollow' class='comment-reply-link' href='index3094.html?replytocom=3#respond' data-commentid="3" data-postid="48" data-belowelement="comment-3" data-respondelement="respond" aria-label='Reply to Jon Canning'>Reply</a>		</div><!-- .reply -->
	</div><!-- #comment-##  -->

	</li><!-- #comment-## -->
	<li class="comment even thread-even depth-1" id="li-comment-4">
		<div id="comment-4">
		<div class="comment-author vcard">
			<img alt='' src='https://secure.gravatar.com/avatar/6d53b3b8324427f08c1ce05f6d582bce?s=40&amp;d=identicon&amp;r=g' srcset='https://secure.gravatar.com/avatar/6d53b3b8324427f08c1ce05f6d582bce?s=80&#038;d=identicon&#038;r=g 2x' class='avatar avatar-40 photo' height='40' width='40' /><cite class="fn">Will</cite> <span class="says">says:</span>


		</div><!-- .comment-author .vcard -->

		<div class="comment-meta commentmetadata"><a href="index.html#comment-4">
			November 6, 2013 at 11:35 pm</a>		</div><!-- .comment-meta .commentmetadata -->

		<div class="comment-body">
				<p>Try this:
        public override IDictionary Serialize(object obj, JavaScriptSerializer serializer)
        {
            return (obj as IDictionary).ToDictionary(kvp =&gt; kvp.Key, kvp =&gt; kvp.Value);
        }</p>
</div>

		<div class="reply">
			<a rel='nofollow' class='comment-reply-link' href='index21b4.html?replytocom=4#respond' data-commentid="4" data-postid="48" data-belowelement="comment-4" data-respondelement="respond" aria-label='Reply to Will'>Reply</a>		</div><!-- .reply -->
	</div><!-- #comment-##  -->

	</li><!-- #comment-## -->
	
	</ol>

	
	<div id="respond" class="comment-respond">
		<h3 id="reply-title" class="comment-reply-title">Leave a Reply to <a href="#comment-3">Jon Canning</a> <small><a rel="nofollow" id="cancel-comment-reply-link" href="index.html#respond">Cancel reply</a></small></h3><form action="https://www.patridgedev.com/wp-comments-post.php" method="post" id="commentform" class="comment-form"><p class="comment-notes"><span id="email-notes">Your email address will not be published.</span> Required fields are marked <span class="required">*</span></p><p class="comment-form-comment"><label for="comment">Comment</label> <textarea id="comment" name="comment" cols="45" rows="8" maxlength="65525" required="required"></textarea></p><p class="comment-form-author"><label for="author">Name <span class="required">*</span></label> <input id="author" name="author" type="text" value="" size="30" maxlength="245" required='required' /></p>
<p class="comment-form-email"><label for="email">Email <span class="required">*</span></label> <input id="email" name="email" type="text" value="" size="30" maxlength="100" aria-describedby="email-notes" required='required' /></p>
<p class="comment-form-url"><label for="url">Website</label> <input id="url" name="url" type="text" value="" size="30" maxlength="200" /></p>
<p class="comment-form-cookies-consent"><input id="wp-comment-cookies-consent" name="wp-comment-cookies-consent" type="checkbox" value="yes" /> <label for="wp-comment-cookies-consent">Save my name, email, and website in this browser for the next time I comment.</label></p>
<p class="form-submit"><input name="submit" type="submit" id="submit" class="submit" value="Post Comment" /> <input type='hidden' name='comment_post_ID' value='48' id='comment_post_ID' />
<input type='hidden' name='comment_parent' id='comment_parent' value='3' />
</p><p style="display: none;"><input type="hidden" id="akismet_comment_nonce" name="akismet_comment_nonce" value="e61ab00be0" /></p><p style="display: none !important;"><label>&#916;<textarea name="ak_hp_textarea" cols="45" rows="8" maxlength="100"></textarea></label><input type="hidden" id="ak_js_1" name="ak_js" value="179"/><script>document.getElementById( "ak_js_1" ).setAttribute( "value", ( new Date() ).getTime() );</script></p></form>	</div><!-- #respond -->
	<p class="akismet_comment_form_privacy_notice">This site uses Akismet to reduce spam. <a href="https://akismet.com/privacy/" target="_blank" rel="nofollow noopener">Learn how your comment data is processed</a>.</p>
</div><!-- #comments -->


						</div><!-- #content -->
			<div id="primary" class="widget-area" role="complementary">

		
		
			<ul class="xoxo">
				<li id="search-2" class="widget-container widget_search"><form method="get" id="searchform" action="https://www.patridgedev.com/">
	<label>
		<span class="screen-reader-text">Search for:</span>
		<input type="search" class="s" placeholder="Search" value="" name="s" />
	</label>
	<button type="submit" class="searchsubmit"><span class="screen-reader-text">Search</span>OK</button>
</form>
</li>		<li id="recent-posts-2" class="widget-container widget_recent_entries">		<h3 class="widget-title">Recent Posts</h3>		<ul>
											<li>
					<a href="../../../../2019/09/27/copy-command-line-output-to-the-clipboard-on-macos-windows-and-linux/index.html">Copy command line output to the clipboard on macOS, Windows, and Linux</a>
									</li>
											<li>
					<a href="../../../../2019/08/06/determine-sha-hash-of-file-on-windows-linux-and-macos/index.html">Determine SHA hash of file on Windows, Linux, and macOS</a>
									</li>
											<li>
					<a href="../../../../2019/05/20/workaround-xamarin-android-long-paths-on-windows/index.html">Workaround: Xamarin.Android long paths on Windows</a>
									</li>
											<li>
					<a href="../../../../2019/02/06/play-japanese-famicom-games-with-your-us-nintendo-switch-online-account/index.html">Play Japanese Famicom games with your US Nintendo Switch Online account</a>
									</li>
											<li>
					<a href="../../../../2018/10/29/fallback-variables-in-dotnet-new-templates/index.html">Fallback variables in `dotnet new` templates</a>
									</li>
					</ul>
		</li><li id="text-3" class="widget-container widget_text">			<div class="textwidget"><p><!--Amazon--><br />
<iframe src="http://web.archive.org/web/20190427210543if_/http://rcm-na.amazon-adsystem.com/e/cm?t=pricetrack-20&amp;o=1&amp;p=9&amp;l=ez&amp;f=ifr&amp;f=ifr&amp;linkID=U4QK3RSRY7VEZR26" scrolling="no" marginwidth="0" marginheight="0" border="0" frameborder="0" style="border:none;"></iframe></p>
</div>
		</li>			</ul>

			<ul class="xoxo">
				<li id="text-2" class="widget-container widget_text"><h3 class="widget-title">PatridgeDev elsewhere</h3>			<div class="textwidget"><p><a href="https://stackoverflow.com/users/48700/patridge"><br />
<img src="https://stackoverflow.com/users/flair/48700.png" width="208" height="58" alt="profile for patridge at Stack Overflow, Q&amp;A for professional and enthusiast programmers" title="profile for patridge at Stack Overflow, Q&amp;A for professional and enthusiast programmers"><br />
</a>
</div>
<div>
<a href="https://xamarin.com/mvp"><img src="../../../../wp-content/uploads/2015/04/MVP-Badge2-300x127.png" alt="Xamarin MVP" style="width:200px;"/></a>
</div>
<div>
<a href="https://university.xamarin.com/certification"><img src="../../../../wp-content/uploads/2015/04/Xamarin-Ceritified-Mobile-Developer-Badge-small-res.png" alt="Xamarin Certified Mobile Developer" style="width:150px;"/></a>
</div>
<div>
<a class="twitter-timeline" href="https://twitter.com/PatridgeDev" data-widget-id="349542841673973761">Tweets by @PatridgeDev</a><br />
<script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+"://platform.twitter.com/widgets.js";fjs.parentNode.insertBefore(js,fjs);}}(document,"script","twitter-wjs");</script></p>
</div>
		</li>			</ul>

			
		</div><!-- #primary .widget-area -->

			</section><!-- #container -->

	<div style="clear:both;"></div>

	</div> <!-- #forbottom -->
	</div><!-- #main -->


	<footer id="footer" role="contentinfo">
		<div id="colophon">
		
			

	<div id="footer-widget-area"  role="complementary"  class="footerone" >

	
			<div id="second" class="widget-area">
			<ul class="xoxo">
				<li id="text-5" class="widget-container widget_text">			<div class="textwidget"><div id="amzn-assoc-ad-d543690b-5196-4e42-ab6e-dc8f3891227e"></div>
<p><script async src="http://z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=d543690b-5196-4e42-ab6e-dc8f3891227e"></script></p>
</div>
		</li>			</ul>
		</div><!-- #second .widget-area -->
	
	
		
	</div><!-- #footer-widget-area -->
			
		</div><!-- #colophon -->

		<div id="footer2">
		
			<div style="text-align:center;clear:both;padding-top:4px;" >
	<a href="../../../../index.html" title="PatridgeDev" rel="home">
		PatridgeDev</a> | Powered by <a target="_blank" href="http://www.cryoutcreations.eu/mantra" title="Mantra Theme by Cryout Creations">Mantra</a> &amp; <a target="_blank" href="http://wordpress.org/"
		title="Semantic Personal Publishing Platform">  WordPress.	</a>
</div><!-- #site-info --> 	<div class="socials" id="sfooter"> 
	
			<a target="_blank" rel="nofollow" href="https://twitter.com/patridgedev" class="socialicons social-Twitter" title="Twitter">
				<img alt="Twitter" src="../../../../wp-content/themes/mantra.3.2.0_custom/resources/images/socials/Twitter.png" />
			</a>
            	</div>
				
		</div><!-- #footer2 -->

	</footer><!-- #footer -->

</div><!-- #wrapper -->

<script type='text/javascript' src='../../../../wp-includes/js/comment-reply.mine6b3.js?ver=5.4.11'></script>
<script type='text/javascript' src='../../../../wp-includes/js/wp-embed.mine6b3.js?ver=5.4.11'></script>

</body>
</html>
