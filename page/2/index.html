<!DOCTYPE html>
<html lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
<meta name="viewport" content="width=device-width, user-scalable=yes, initial-scale=1.0, minimum-scale=1.0, maximum-scale=3.0">
<link rel="apple-touch-icon" href="../../wp-content/themes/mantra_custom/images/favicon/apple-touch-icon.html" />
<link rel="profile" href="https://gmpg.org/xfn/11" />
<link rel="pingback" href="../../xmlrpc.php" />
<title>PatridgeDev &#8211; Page 2 &#8211; Software developer obsessed with helping others do more with training, tooling, and automation.</title>
<link rel='dns-prefetch' href='https://fonts.googleapis.com/' />
<link rel='dns-prefetch' href='https://s.w.org/' />
<link rel="alternate" type="application/rss+xml" title="PatridgeDev &raquo; Feed" href="../../feed/index.html" />
<link rel="alternate" type="application/rss+xml" title="PatridgeDev &raquo; Comments Feed" href="../../comments/feed/index.html" />
		<!-- This site uses the Google Analytics by MonsterInsights plugin v8.5.2 - Using Analytics tracking - https://www.monsterinsights.com/ -->
							<script src="https://www.googletagmanager.com/gtag/js?id=UA-24616833-1"  data-cfasync="false" data-wpfc-render="false" type="text/javascript" async></script>
			<script data-cfasync="false" data-wpfc-render="false" type="text/javascript">
				var mi_version = '8.5.2';
				var mi_track_user = true;
				var mi_no_track_reason = '';
				
								var disableStrs = [
										'ga-disable-G-3WN7RP75N7',
															'ga-disable-UA-24616833-1',
									];

				/* Function to detect opted out users */
				function __gtagTrackerIsOptedOut() {
					for ( var index = 0; index < disableStrs.length; index++ ) {
						if ( document.cookie.indexOf( disableStrs[ index ] + '=true' ) > -1 ) {
							return true;
						}
					}

					return false;
				}

				/* Disable tracking if the opt-out cookie exists. */
				if ( __gtagTrackerIsOptedOut() ) {
					for ( var index = 0; index < disableStrs.length; index++ ) {
						window[ disableStrs[ index ] ] = true;
					}
				}

				/* Opt-out function */
				function __gtagTrackerOptout() {
					for ( var index = 0; index < disableStrs.length; index++ ) {
						document.cookie = disableStrs[ index ] + '=true; expires=Thu, 31 Dec 2099 23:59:59 UTC; path=/';
						window[ disableStrs[ index ] ] = true;
					}
				}

				if ( 'undefined' === typeof gaOptout ) {
					function gaOptout() {
						__gtagTrackerOptout();
					}
				}
								window.dataLayer = window.dataLayer || [];

				window.MonsterInsightsDualTracker = {
					helpers: {},
					trackers: {},
				};
				if ( mi_track_user ) {
					function __gtagDataLayer() {
						dataLayer.push( arguments );
					}

					function __gtagTracker( type, name, parameters ) {
						if (!parameters) {
							parameters = {};
						}

						if (parameters.send_to) {
							__gtagDataLayer.apply( null, arguments );
							return;
						}

						if ( type === 'event' ) {
															parameters.send_to = monsterinsights_frontend.v4_id;
								var hookName = name;
								if ( typeof parameters[ 'event_category' ] !== 'undefined' ) {
									hookName = parameters[ 'event_category' ] + ':' + name;
								}

								if ( typeof MonsterInsightsDualTracker.trackers[ hookName ] !== 'undefined' ) {
									MonsterInsightsDualTracker.trackers[ hookName ]( parameters );
								} else {
									__gtagDataLayer( 'event', name, parameters );
								}
							
															parameters.send_to = monsterinsights_frontend.ua;
								__gtagDataLayer( type, name, parameters );
													} else {
							__gtagDataLayer.apply( null, arguments );
						}
					}
					__gtagTracker( 'js', new Date() );
					__gtagTracker( 'set', {
						'developer_id.dZGIzZG' : true,
											} );
										__gtagTracker( 'config', 'G-3WN7RP75N7', {"forceSSL":"true","link_attribution":"true"} );
															__gtagTracker( 'config', 'UA-24616833-1', {"forceSSL":"true","link_attribution":"true"} );
										window.gtag = __gtagTracker;											(function () {
							/* https://developers.google.com/analytics/devguides/collection/analyticsjs/ */
							/* ga and __gaTracker compatibility shim. */
							var noopfn = function () {
								return null;
							};
							var newtracker = function () {
								return new Tracker();
							};
							var Tracker = function () {
								return null;
							};
							var p = Tracker.prototype;
							p.get = noopfn;
							p.set = noopfn;
							p.send = function (){
								var args = Array.prototype.slice.call(arguments);
								args.unshift( 'send' );
								__gaTracker.apply(null, args);
							};
							var __gaTracker = function () {
								var len = arguments.length;
								if ( len === 0 ) {
									return;
								}
								var f = arguments[len - 1];
								if ( typeof f !== 'object' || f === null || typeof f.hitCallback !== 'function' ) {
									if ( 'send' === arguments[0] ) {
										var hitConverted, hitObject = false, action;
										if ( 'event' === arguments[1] ) {
											if ( 'undefined' !== typeof arguments[3] ) {
												hitObject = {
													'eventAction': arguments[3],
													'eventCategory': arguments[2],
													'eventLabel': arguments[4],
													'value': arguments[5] ? arguments[5] : 1,
												}
											}
										}
										if ( 'pageview' === arguments[1] ) {
											if ( 'undefined' !== typeof arguments[2] ) {
												hitObject = {
													'eventAction': 'page_view',
													'page_path' : arguments[2],
												}
											}
										}
										if ( typeof arguments[2] === 'object' ) {
											hitObject = arguments[2];
										}
										if ( typeof arguments[5] === 'object' ) {
											Object.assign( hitObject, arguments[5] );
										}
										if ( 'undefined' !== typeof arguments[1].hitType ) {
											hitObject = arguments[1];
											if ( 'pageview' === hitObject.hitType ) {
												hitObject.eventAction = 'page_view';
											}
										}
										if ( hitObject ) {
											action = 'timing' === arguments[1].hitType ? 'timing_complete' : hitObject.eventAction;
											hitConverted = mapArgs( hitObject );
											__gtagTracker( 'event', action, hitConverted );
										}
									}
									return;
								}

								function mapArgs( args ) {
									var arg, hit = {};
									var gaMap = {
										'eventCategory': 'event_category',
										'eventAction': 'event_action',
										'eventLabel': 'event_label',
										'eventValue': 'event_value',
										'nonInteraction': 'non_interaction',
										'timingCategory': 'event_category',
										'timingVar': 'name',
										'timingValue': 'value',
										'timingLabel': 'event_label',
										'page' : 'page_path',
										'location' : 'page_location',
										'title' : 'page_title',
									};
									for ( arg in args ) {
																				if ( ! ( ! args.hasOwnProperty(arg) || ! gaMap.hasOwnProperty(arg) ) ) {
											hit[gaMap[arg]] = args[arg];
										} else {
											hit[arg] = args[arg];
										}
									}
									return hit;
								}

								try {
									f.hitCallback();
								} catch ( ex ) {
								}
							};
							__gaTracker.create = newtracker;
							__gaTracker.getByName = newtracker;
							__gaTracker.getAll = function () {
								return [];
							};
							__gaTracker.remove = noopfn;
							__gaTracker.loaded = true;
							window['__gaTracker'] = __gaTracker;
						})();
									} else {
										console.log( "" );
					( function () {
							function __gtagTracker() {
								return null;
							}
							window['__gtagTracker'] = __gtagTracker;
							window['gtag'] = __gtagTracker;
					} )();
									}
			</script>
				<!-- / Google Analytics by MonsterInsights -->
				<script type="text/javascript">
			window._wpemojiSettings = {"baseUrl":"https:\/\/s.w.org\/images\/core\/emoji\/12.0.0-1\/72x72\/","ext":".png","svgUrl":"https:\/\/s.w.org\/images\/core\/emoji\/12.0.0-1\/svg\/","svgExt":".svg","source":{"concatemoji":"https:\/\/www.patridgedev.com\/wp-includes\/js\/wp-emoji-release.min.js?ver=5.4.11"}};
			/*! This file is auto-generated */
			!function(e,a,t){var n,r,o,i=a.createElement("canvas"),p=i.getContext&&i.getContext("2d");function s(e,t){var a=String.fromCharCode;p.clearRect(0,0,i.width,i.height),p.fillText(a.apply(this,e),0,0);e=i.toDataURL();return p.clearRect(0,0,i.width,i.height),p.fillText(a.apply(this,t),0,0),e===i.toDataURL()}function c(e){var t=a.createElement("script");t.src=e,t.defer=t.type="text/javascript",a.getElementsByTagName("head")[0].appendChild(t)}for(o=Array("flag","emoji"),t.supports={everything:!0,everythingExceptFlag:!0},r=0;r<o.length;r++)t.supports[o[r]]=function(e){if(!p||!p.fillText)return!1;switch(p.textBaseline="top",p.font="600 32px Arial",e){case"flag":return s([127987,65039,8205,9895,65039],[127987,65039,8203,9895,65039])?!1:!s([55356,56826,55356,56819],[55356,56826,8203,55356,56819])&&!s([55356,57332,56128,56423,56128,56418,56128,56421,56128,56430,56128,56423,56128,56447],[55356,57332,8203,56128,56423,8203,56128,56418,8203,56128,56421,8203,56128,56430,8203,56128,56423,8203,56128,56447]);case"emoji":return!s([55357,56424,55356,57342,8205,55358,56605,8205,55357,56424,55356,57340],[55357,56424,55356,57342,8203,55358,56605,8203,55357,56424,55356,57340])}return!1}(o[r]),t.supports.everything=t.supports.everything&&t.supports[o[r]],"flag"!==o[r]&&(t.supports.everythingExceptFlag=t.supports.everythingExceptFlag&&t.supports[o[r]]);t.supports.everythingExceptFlag=t.supports.everythingExceptFlag&&!t.supports.flag,t.DOMReady=!1,t.readyCallback=function(){t.DOMReady=!0},t.supports.everything||(n=function(){t.readyCallback()},a.addEventListener?(a.addEventListener("DOMContentLoaded",n,!1),e.addEventListener("load",n,!1)):(e.attachEvent("onload",n),a.attachEvent("onreadystatechange",function(){"complete"===a.readyState&&t.readyCallback()})),(n=t.source||{}).concatemoji?c(n.concatemoji):n.wpemoji&&n.twemoji&&(c(n.twemoji),c(n.wpemoji)))}(window,document,window._wpemojiSettings);
		</script>
		<style type="text/css">
img.wp-smiley,
img.emoji {
	display: inline !important;
	border: none !important;
	box-shadow: none !important;
	height: 1em !important;
	width: 1em !important;
	margin: 0 .07em !important;
	vertical-align: -0.1em !important;
	background: none !important;
	padding: 0 !important;
}
</style>
	<link rel='stylesheet' id='wp-block-library-css'  href='../../wp-includes/css/dist/block-library/style.mine6b3.css?ver=5.4.11' type='text/css' media='all' />
<link rel='stylesheet' id='mantra-style-css'  href='../../wp-content/themes/mantra.3.2.0_custom/style55a0.css?ver=3.2.0' type='text/css' media='all' />
<style id='mantra-style-inline-css' type='text/css'>
 #wrapper { max-width: 1140px; } #content { width: 100%; max-width:800px; max-width: calc( 100% - 340px ); } #primary, #secondary { width:340px; } #primary .widget-title, #secondary .widget-title { margin-right: -2em; text-align: left; } html { font-size:15px; } body, input, textarea {font-family:"Open Sans"; } #content h1.entry-title a, #content h2.entry-title a, #content h1.entry-title, #content h2.entry-title, #front-text1 h2, #front-text2 h2 {font-family: "Merriweather"; } .widget-area {font-family:"Open Sans"; } .entry-content h1, .entry-content h2, .entry-content h3, .entry-content h4, .entry-content h5, .entry-content h6 {font-family:"Merriweather"; } .nocomments, .nocomments2 {display:none;} #header-container > div { margin-top:30px; } #header-container > div { margin-left:30px; } body { background-color:#444444 !important; } #header { background-color:#333333; } #footer { background-color:#222222; } #footer2 { background-color:#171717; } #site-title span a { color:#0D85CC; } #site-description { color:#999999; } #content { color:#555555 ;} .widget-area a:link, .widget-area a:visited, a:link, a:visited ,#searchform #s:hover, #container #s:hover, #access a:hover, #wp-calendar tbody td a, #site-info a, #site-copyright a, #access li:hover > a, #access ul ul:hover > a { color:#0D85CC; } a:hover, .entry-meta a:hover, .entry-utility a:hover, .widget-area a:hover { color:#12a7ff; } #content .entry-title a, #content .entry-title, #content h1, #content h2, #content h3, #content h4, #content h5, #content h6 { color:#444444; } #content .entry-title a:hover { color:#000000; } .widget-title { background-color:#444444; } .widget-title { color:#FFFFFF; } #footer-widget-area .widget-title { color:#FFFFFF; } #footer-widget-area a { color:#666666; } #footer-widget-area a:hover { color:#888888; } .png); } .entry-content p:not(:last-child), .entry-content ul, .entry-summary ul, .entry-content ol, .entry-summary ol { margin-bottom:1.5em;} .entry-meta .entry-time { display:none; } #branding { height:125px ;} 
/* Mantra Custom CSS */
</style>
<link rel='stylesheet' id='mantra-googlefont-css'  href='https://fonts.googleapis.com/css?family=Open+Sans%3A400%2C700&amp;ver=5.4.11' type='text/css' media='all' />
<link rel='stylesheet' id='mantra-googlefont-title-css'  href='https://fonts.googleapis.com/css?family=Merriweather%3A400%2C700&amp;ver=5.4.11' type='text/css' media='all' />
<link rel='stylesheet' id='mantra-googlefont-side-css'  href='https://fonts.googleapis.com/css?family=Open+Sans%3A400%2C700&amp;ver=5.4.11' type='text/css' media='all' />
<link rel='stylesheet' id='mantra-googlefont-headings-css'  href='https://fonts.googleapis.com/css?family=Merriweather%3A400%2C700&amp;ver=5.4.11' type='text/css' media='all' />
<link rel='stylesheet' id='mantra-mobile-css'  href='../../wp-content/themes/mantra.3.2.0_custom/resources/css/style-mobile55a0.css?ver=3.2.0' type='text/css' media='all' />
<script type='text/javascript' src='../../wp-content/plugins/google-analytics-for-wordpress/assets/js/frontend-gtag.min8833.js?ver=8.5.2'></script>
<script data-cfasync="false" data-wpfc-render="false" type="text/javascript" id='monsterinsights-frontend-script-js-extra'>/* <![CDATA[ */
var monsterinsights_frontend = {"js_events_tracking":"true","download_extensions":"doc,pdf,ppt,zip,xls,docx,pptx,xlsx","inbound_paths":"[{\"path\":\"\\\/go\\\/\",\"label\":\"affiliate\"},{\"path\":\"\\\/recommend\\\/\",\"label\":\"affiliate\"}]","home_url":"https:\/\/www.patridgedev.com","hash_tracking":"false","ua":"UA-24616833-1","v4_id":"G-3WN7RP75N7"};/* ]]> */
</script>
<script type='text/javascript' src='../../wp-includes/js/jquery/jquery4a5f.js?ver=1.12.4-wp'></script>
<script type='text/javascript' src='../../wp-includes/js/jquery/jquery-migrate.min330a.js?ver=1.4.1'></script>
<script type='text/javascript'>
/* <![CDATA[ */
var mantra_options = {"responsive":"1","image_class":"imageNone","equalize_sidebars":"0"};
/* ]]> */
</script>
<script type='text/javascript' src='../../wp-content/themes/mantra.3.2.0_custom/resources/js/frontend55a0.js?ver=3.2.0'></script>
<link rel='https://api.w.org/' href='../../wp-json/index.html' />
<link rel="EditURI" type="application/rsd+xml" title="RSD" href="../../xmlrpc0db0.php?rsd" />
<link rel="wlwmanifest" type="application/wlwmanifest+xml" href="../../wp-includes/wlwmanifest.xml" /> 
<meta name="generator" content="WordPress 5.4.11" />
<!--[if lte IE 8]> <style type="text/css" media="screen"> #access ul li, .edit-link a , #footer-widget-area .widget-title, .entry-meta,.entry-meta .comments-link, .short-button-light, .short-button-dark ,.short-button-color ,blockquote { position:relative; behavior: url(/wp-content/themes/mantra.3.2.0_custom/resources/js/PIE/PIE.php); } #access ul ul { -pie-box-shadow:0px 5px 5px #999; } #access ul li.current_page_item, #access ul li.current-menu-item , #access ul li ,#access ul ul ,#access ul ul li, .commentlist li.comment ,.commentlist .avatar, .nivo-caption, .theme-default .nivoSlider { behavior: url(/wp-content/themes/mantra.3.2.0_custom/resources/js/PIE/PIE.php); } </style> <![endif]--><!--[if lt IE 9]> 
	<script>
	document.createElement('header');
	document.createElement('nav');
	document.createElement('section');
	document.createElement('article');
	document.createElement('aside');
	document.createElement('footer');
	document.createElement('hgroup');
	</script>
	<![endif]--> 		<style type="text/css" id="wp-custom-css">
			#site-description { text-transform: none; }		</style>
			<link href="https://plus.google.com/103902189108210179119" rel="author" />
</head>
<body class="home blog paged paged-2 mantra-image-none mantra-caption-light mantra-hratio-0 mantra-sidebar-right mantra-menu-left">

    <div id="toTop"><i class="crycon-back2top"></i> </div>
	
<div id="wrapper" class="hfeed">


<header id="header">

		<div id="masthead">

			<div id="branding" role="banner" >

					
	<div id="header-container">
	
				<div>
				<h1 id="site-title">
					<span> <a href="../../index.html" title="PatridgeDev" rel="home">PatridgeDev</a> </span>
				</h1>
				<div id="site-description" >Software developer obsessed with helping others do more with training, tooling, and automation.</div>
			</div> 	<div class="socials" id="sheader"> 
	
			<a target="_blank" rel="nofollow" href="https://twitter.com/patridgedev" class="socialicons social-Twitter" title="Twitter">
				<img alt="Twitter" src="../../wp-content/themes/mantra.3.2.0_custom/resources/images/socials/Twitter.png" />
			</a>
            	</div>
		</div> <!-- #header-container -->
					<div style="clear:both;"></div>

			</div><!-- #branding -->

            <a id="nav-toggle"><span>&nbsp; Menu</span></a>
			<nav id="access" class="jssafe" role="navigation">

					<div class="skip-link screen-reader-text"><a href="#content" title="Skip to content">Skip to content</a></div>
	<div id="prime_nav" class="menu"><ul>
<li ><a href="../../index.html">Home</a></li><li class="page_item page-item-6"><a href="../../about-me/index.html">About Me</a></li>
<li class="page_item page-item-321 page_item_has_children"><a href="../../smudges/index.html">Smudges</a>
<ul class='children'>
	<li class="page_item page-item-336"><a href="../../smudges/smudges-privacy-policy/index.html">Smudges Privacy Policy</a></li>
</ul>
</li>
</ul></div>

			</nav><!-- #access -->

		</div><!-- #masthead -->

	<div style="clear:both;"> </div>

</header><!-- #header -->
<div id="main" class="main">
	<div  id="forbottom" >
			<div class="socials" id="smenur"> 
	
			<a target="_blank" rel="nofollow" href="https://twitter.com/patridgedev" class="socialicons social-Twitter" title="Twitter">
				<img alt="Twitter" src="../../wp-content/themes/mantra.3.2.0_custom/resources/images/socials/Twitter.png" />
			</a>
            	</div>
	
		<div style="clear:both;"> </div>

				<section id="container">

			<div id="content" role="main">


						<nav id="nav-above" class="navigation">
			<div class="nav-previous"><a href="../3/index.html" ><span class="meta-nav">&laquo;</span> Older posts</a></div>
			<div class="nav-next"><a href="../../index.html" >Newer posts <span class="meta-nav">&raquo;</span></a></div>
		</nav><!-- #nav-above -->
	
								
					
	<article id="post-609" class="post-609 post type-post status-publish format-standard hentry category-dev tag-template">
		<header class="entry-header">	
			<h2 class="entry-title">
				<a href="../../2018/10/22/add-variables-to-your-custom-dotnet-new-template/index.html" title="Permalink to Add variables to your custom `dotnet new` template" rel="bookmark">
					Add variables to your custom `dotnet new` template				</a>
			</h2>
						<div class="entry-meta">
				 <span class="author vcard" > By  <a class="url fn n" rel="author" href="../../author/adam/index.html" title="View all posts by adam">adam</a> <span class="bl_sep">|</span></span>  <time class="onDate date published" datetime="2018-10-22T14:00:49+00:00"> <a href="../../2018/10/22/add-variables-to-your-custom-dotnet-new-template/index.html" title="2:00 pm" rel="bookmark"><span class="entry-date">October 22, 2018</span> <span class="entry-time"> - 2:00 pm</span></a> </time><span class="bl_sep">|</span><time class="updated"  datetime="2018-10-22T14:00:49+00:00">October 22, 2018</time> <span class="bl_categ"> <a href="../../category/dev/index.html" rel="tag">dev</a> </span>  							<div class="comments-link">
				<a href="../../2018/10/22/add-variables-to-your-custom-dotnet-new-template/index.html#respond">Leave a comment</a>			</div>
						</div><!-- .entry-meta -->
			
		
		</header><!-- .entry-header -->
									<div class="entry-content">
						<p>Previously, I covered <a href="../../2018/10/09/making-a-custom-dotnet-new-template/index.html">creating your first custom <code>dotnet new</code> template</a>. Now, let&#8217;s work on customizing the content our template generates based on inputs provided via the command line. I’ll be working from the <a href="../../2018/10/09/making-a-custom-dotnet-new-template/index.html">same custom template from that post</a>, which is just a <code>dotnet new console</code> output with its own <strong>.template.config</strong> setup. If you want a starter template project to get you going, use the template from the <a href="https://github.com/patridge/demo-custom-dotnet-template/tree/master/1-custom-template"><strong>1-custom-template</strong> folder</a> from the <a href="https://github.com/patridge/demo-custom-dotnet-template">Git repo from that blog post</a>.</p>

<blockquote>
  <p>This is the second in a collection of posts about <a href="../../tag/template/index.html">creating custom templates for the <code>dotnet new</code> system</a>.</p>
</blockquote>

<h2>Your first input parameter</h2>

<p>When you are generating content from a template, your first parameter for controlling things is built in to the SDK. There are two variables used to decide where to put the generated content: <code>--output</code> and <code>--name</code>. If you provide a path via <code>--output "some/path"</code>, the content will be generated in that location. If, in your template&#8217;s <strong>template.json</strong> file, you set <code>"preferNameDirectory": true</code>, you can set the same path via <code>--name "some/path"</code>. (If you have the <code>preferNameDirectory</code> variable set to true and provide both an <code>output</code> and <code>name</code> variable, it will use the <code>output</code> value.) Without either command-line parameter, the new content will be generated in the current directory.</p>

<p>Passing in more useful data for your template requires some additional changes to the <strong>template.json</strong> configuration.</p>

<h2>Taking inputs for generating content</h2>

<p>To start consuming inputs to alter your generated content, add a new object to the template configuration JSON in <strong>template.json</strong>.</p>

<!-- language: javascript -->

<pre><code>{
    "$schema": "https://json.schemastore.org/template",
    ...
    "symbols": {
        "helloMessage": {
            "type": "parameter",
            "replaces": "Hello from a new template!"
        }
    }
}
</code></pre>

<p>This sets up your template to take a <code>helloMessage</code> parameter via the command line like this.</p>

<!-- language: bash -->

<pre><code>dotnet new console-awesome --helloMessage "Hello from a command line override!"
</code></pre>

<p>The resulting Program.cs file will have a call using our custom parameter.</p>

<!-- language:csharp -->

<pre><code>Console.WriteLine("Hello from a command line override!");
</code></pre>

<p>If we don&#8217;t pass in that <code>helloMessage</code> parameter, the substitution is made with the value set in  a symbol&#8217;s <code>defaultValue</code> field.</p>

<p>When the content is generated, it will process the template files and replace all instances of “Hello from a new template!“ with the provided parameter value. We only have one instance here, but you could have several if your template requires it.</p>

<h2>Making the output more predictable</h2>

<p>Since the template system does a find-and-replace on our symbols defining a <code>replaces</code> value, I want to make sure it doesn&#8217;t accidentally find any other instances I didn&#8217;t intend for it to replace. To do that, I will typically use a placeholder string that is always replaced, like a template token.</p>

<p>Most template examples I have looked over seem to put default data in the file to be processed and replace that value with the <code>replaces</code> value. I tend to use a placeholder string and a <code>defaultValue</code> within the symbol instead. They both result in the same generated content, so let your own preferences guide you here. I feel like I’m less likely to have identical text elsewhere that will get accidentally replaced as a &#8220;false positive&#8221; when I use replacement tokens than with actual content.</p>

<p>In the previous example, I would replace the <code>WriteLine</code> parameter in C# with something like <code>Console.WriteLine(”{helloMessage}”)</code> and configure the symbol like this.</p>

<!-- language: json -->

<pre><code>{
    "$schema": "https://json.schemastore.org/template",
    ...
    "symbols": {
        "helloMessage": {
            "type": "parameter",
            "replaces": "{helloMessage}",
            "defaultValue": "Hello from a new template!"
        }
    }
}
</code></pre>

<p>You will end up creating a symbol for each input you want to accept from the command line, and several more advanced steps. You will also create symbols for some of the processing you wish to do to other inputs, for example changing the letter casing of a provided value.</p>

<h2>Changing input parameter casing</h2>

<p>There are lots of things we can do to incoming parameter values, but we’ll start with a simple one: forcing something to all uppercase or lowercase. If you&#8217;re taking in an input from a user of your template, you can’t always rely on them providing the expected input. For example, if you expect an ID field in your template to have letters in uppercase only, you will want to set it up to enforce that when the templated content is generated.</p>

<p>We add this string modification as a second symbol that will derive a modified value from the original, keeping the original also available if you need it. To do so, return to your <strong>.template.config</strong> > <strong>template.config</strong> file.</p>

<p>In the <strong>symbols</strong> section of the config file, add a new symbol to capitalize the existing <code>helloMessage</code> symbol; I don&#8217;t know if there&#8217;s a best practice, but I try to name my modifier symbols after what they do. So, in this case, name your new symbol <code>helloMessageUpper</code>. Let&#8217;s see what that will look like.</p>

<!-- language: json -->

<pre><code>"symbols": {
   "helloMessage": {
       "description": "",
       "type": "parameter",
       "replaces": "{helloMessage}",
       "defaultValue": "Hello from a new template!"
   },
   "helloMessageUpper": {
       "type": "generated",
       "generator": "casing",
       "parameters": {
         "source": "helloMessage",
         "toLower": false
       },
       "replaces": "{helloMessageUpper}"
   }
</code></pre>

<p>}</p>

<p>First, we still have our input symbol, <code>helloMessage</code>. Then, we add our new <code>helloMessageUpper</code> symbol. To tell the system we are making a computed symbol, we set the <code>type</code> of our symbol to <code>generated. We then need to tell it what kind of</code>generator<code>to use:</code>casing` in this case, to tell the system we are going to modify the casing on some other symbol.</p>

<p>When you use a generator symbol, you often require some additional configuration, which is done with a <code>parameters</code> configuration object. In this case, you provide a <code>source</code> symbol, the input to our casing generator, and the direction to adjust the letter casing in a <code>toLower</code> boolean value.</p>

<p>The <code>toLower</code> boolean value doesn&#8217;t have any sort of <code>toUpper</code> equivalent. As you might expect, if you set it to <code>true</code>, it will result in a lowercase symbol you can use. What may not be as obvious, though, is that setting <code>toLower</code> to <code>false</code> will result in an uppercase symbol.</p>

<p>With the generator configured, we simply add a <code>replaces</code> value again to tell it what gets our new uppercase-transformed input in the template output.</p>

<p>To test our output, let&#8217;s add another line in the template C# source.</p>

<!-- language:csharp -->

<pre><code>Console.WriteLine("{helloMessage}");
Console.WriteLine("{helloMessageUpper}");
</code></pre>

<p>Now, we need to install or modified template and generate content from it. From your template directory, make sure you have the latest installed.</p>

<!-- language:console -->

<pre><code>dotnet new --install .
</code></pre>

<p>If we generate a project from our modified template without any command-line parameters, we get the default symbol value. That default is also fed into the generated symbol for it&#8217;s upper-case equivalent.</p>

<p>This command…</p>

<!-- language: bash -->

<pre><code>dotnet new console-awesome --output TestRunNoParameter
</code></pre>

<p>…results in a <strong>TestRunNoParameter/Program.cs</strong> containing these calls. (Remember, the <code>output</code> parameter will generate the content in a folder with that name, used here to keep our test output organized.)</p>

<!-- language:csharp -->

<pre><code>Console.WriteLine("Hello from a new template!");
Console.WriteLine("HELLO FROM A NEW TEMPLATE!");
</code></pre>

<p>And when we provide our own command-line parameter, it substitutes the provided value as above and also passes that value into the upper-case generator.</p>

<p>This command…</p>

<!-- language: bash -->

<pre><code>dotnet new console-awesome --helloMessage "Hello from a command line override!" --output "TestRunParameterOverride"
</code></pre>

<p>…results in these calls in Program.cs.</p>

<!-- language:csharp -->

<pre><code>Console.WriteLine("Hello from a command line override!");
Console.WriteLine("HELLO FROM A COMMAND LINE OVERRIDE!");
</code></pre>

<h2>Check your work</h2>

<p>You can now start introducing variables into your <code>dotnet new</code> templates. If you want to compare your work to a template created by following along, check out the <a href="https://github.com/patridge/demo-custom-dotnet-template/tree/master/2-input-parameters"><strong>2-input-parameters</strong> folder</a> of the <a href="https://github.com/patridge/demo-custom-dotnet-template">GitHub repo created for this blog post series</a>.</p>

<p>There&#8217;s so much more that can allow you to do even more advanced things with your templates, some of which I hope to cover in more posts. If there’s something cool that I need to cover, though, <a href="https://twitter.com/patridgedev">reach out to me on Twitter: @patridgedev</a>.</p>
												</div><!-- .entry-content --> 
								<footer class="entry-meta2">
		<span class="bl_tagg">Tagged <a href="../../tag/template/index.html" rel="tag">template</a></span>
 									</footer><!-- #entry-meta -->

	</article><!-- #post-609 -->
	
	

				
					
	<article id="post-597" class="post-597 post type-post status-publish format-standard hentry category-dev tag-template">
		<header class="entry-header">	
			<h2 class="entry-title">
				<a href="../../2018/10/09/making-a-custom-dotnet-new-template/index.html" title="Permalink to Making a custom &#8216;dotnet new&#8217; template" rel="bookmark">
					Making a custom &#8216;dotnet new&#8217; template				</a>
			</h2>
						<div class="entry-meta">
				 <span class="author vcard" > By  <a class="url fn n" rel="author" href="../../author/adam/index.html" title="View all posts by adam">adam</a> <span class="bl_sep">|</span></span>  <time class="onDate date published" datetime="2018-10-09T07:00:23+00:00"> <a href="../../2018/10/09/making-a-custom-dotnet-new-template/index.html" title="7:00 am" rel="bookmark"><span class="entry-date">October 9, 2018</span> <span class="entry-time"> - 7:00 am</span></a> </time><span class="bl_sep">|</span><time class="updated"  datetime="2018-10-09T07:00:23+00:00">October 9, 2018</time> <span class="bl_categ"> <a href="../../category/dev/index.html" rel="tag">dev</a> </span>  							<div class="comments-link">
				<a href="../../2018/10/09/making-a-custom-dotnet-new-template/index.html#respond">Leave a comment</a>			</div>
						</div><!-- .entry-meta -->
			
		
		</header><!-- .entry-header -->
									<div class="entry-content">
						<h2>Why make a template</h2>

<p>I am a bit biased these days, but once I spin up a folder structure and/or text document manually more than twice, I give some thought to templating it. If I need to keep making more of something, the time to get all the boilerplate content in place is time taken away from the good stuff I want to write.</p>

<blockquote>
  <p>This is the first in a series of posts about <a href="../../tag/template/index.html">creating custom templates for the <code>dotnet new</code> system</a>.</p>
</blockquote>

<h2>How to template</h2>

<p>There are lots of templating systems out there that can allow you to create content quickly. If you have used any of the ASP.NET generators, those use Yeoman to spin up new ASP.NET projects quickly. I&#8217;m not saying any template engine is better here, just showing what I&#8217;ve been using lately.</p>

<p>I have been using the templating engine built into the .NET Core SDK, since it tends to be installed on all my development machines. The .NET Core template system is exposed through the <code>dotnet new</code> command-line program, where the <code>dotnet</code> program is able to do way more stuff like compiling code, managing NuGet packages, or running .NET Core applications. (Run <code>dotnet --help</code> to see a list of all the SDK commands available to you.)</p>

<p>That said, if you need to be able to create content from templates in an environment where you don&#8217;t want the full .NET Core SDK installed, you may want to consider other alternatives, or research how to put just a core templating engine into your own tools and deliverables.</p>

<h2>Get started with .NET Core SDK</h2>

<p>You can get the .NET Core SDK installed on macOS, Windows, and Linux. I have it on my MacBook, a couple Windows 10 machines, and a Raspberry Pi or two. If you work with Visual Studio 2017 or Visual Studio for Mac, you may have it installed already, too. From your favorite command line, run the following command to get the current installed .NET Core SDK version on your machine.</p>

<!-- language: bash -->

<pre><code>dotnet --version
</code></pre>

<p>If that fails for you, you can still join in the fun. Run over to the <a href="https://www.microsoft.com/net/learn/get-started/">.NET getting-started guide</a> and click the download link. That link should land you in the right spot for your current platform. After you install the SDK, you may need to close and relaunch any command line windows you had open previously.</p>

<p>Once you have the .NET SDK installed, give that command another run to make sure everything is happy. I am running version <code>2.1.300</code>, which is the <a href="https://github.com/dotnet/sdk/releases">latest release</a> as of writing this. If you got something like <code>2.1.###</code>, you <em>should</em> be able to do everything I&#8217;m doing here (taken with a big Works on My Machine&#x2122; disclaimer).</p>

<h2>Create a project</h2>

<p>The default .NET Core SDK installation will give you some initial templates if you want to give them a shot. To list all the available templates, just run the following command with no parameters.</p>

<!-- language: bash -->

<pre><code>dotnet new --list
</code></pre>

<p>You should have at least some .NET Core templates for console apps, test projects, and ASP.NET projects. Let&#8217;s spin up a .NET Core console app. Each of the templates has a &#8220;short name&#8221; you can pass to <code>dotnet new</code>. If you use a template without any parameters, it will put all the resulting files in your current directory. In this case, this command will create a C# project file named after the current directory and code file (as well as some results in <strong>/obj</strong> because it also does a NuGet restore).</p>

<!-- language: bash -->

<pre><code>dotnet new console
</code></pre>

<p>Don&#8217;t worry, though. If you run this command in a directory where you have conflicting files, it won&#8217;t overwrite them. You&#8217;ll get an error for any conflicts.</p>

<p>So you don&#8217;t have to worry about polluting your current directory, you can give the command another option to drop the template output into a new destination.</p>

<!-- language: bash -->

<pre><code>dotnet new console --output MyConsoleApp
</code></pre>

<p>With the <code>--output</code> parameter and value, the result will be put in the <strong>/MyConsoleApp</strong> folder.</p>

<p>While many of these templates create projects you can immediately compile and/or run, that certainly isn&#8217;t a requirement. In this case, you could run the following commands to execute the resulting console project.</p>

<!-- language: bash -->

<pre><code>cd MyConsoleApp
dotnet run MyConsoleApp.csproj
</code></pre>

<h2>I want my own template</h2>

<p>Now we can start having fun. Let&#8217;s say you need to make your own console template. The only difference between the console project we generated and a template of our own is a <strong>.template.config</strong> folder containing a <strong>template.json</strong> file. First, make a change to your <strong>MyConsoleApp</strong> project to make it your own. A simple-yet-noticeable change would be to edit <strong>Program.cs</strong> to output your own phrase. In my case, I changed the <code>Console.WriteLine</code> call to this.</p>

<!-- language: bash -->

<pre><code>Console.WriteLine("Hello from a new template!");
</code></pre>

<p>Now, we just need the template configuration.</p>

<p>Create a new folder in <strong>MyConsoleApp</strong> called <strong>.template.config</strong>.</p>

<p>Open your favorite text editor and create a new file. Save it to the <strong>.template.config</strong> folder as <strong>template.json</strong>. This JSON file is just the configuration for our template. Here is a sample of the bare minimum this file we might use for our console app template.</p>

<!-- language: json -->

<pre><code>{
    "$schema": "https://json.schemastore.org/template",
    "author": "Adam Patridge",
    "classifications": [ "Console" ],
    "identity": "PatridgeDev.TemplateBlogging.Console.CSharp",
    "name": "Our slightly modified console app",
    "shortName": "console-awesome"
}
</code></pre>

<p>The <code>$schema</code> value is always the same. This just tells compatible IDEs how to offer assistance when creating these documents. For example, Visual Studio Code will use the schema to offer some IntelliSense to us.</p>

<p>The <code>author</code> value is you.</p>

<p>The <code>classifications</code> value is an array of descriptions you might use for your project. Not going to lie, while these are listed when you do <code>dotnet new --list</code>, I have yet to figure out how to query them, or if you even would before you have dozens of templates.</p>

<p>The <code>identity</code> value is just a unique name for our template within the <code>dotnet new</code> list. You can use some sort of reverse-DNS notation as I did or just about anything. (There seems to be a trend to put language in the last portion, but that is likely only needed if you have multiple language versions of a single template.)</p>

<p>The <code>name</code> value is the user-visible name for your template.</p>

<p>Lastly, the <code>shortName</code> value is the name people can use when creating things from templates via command line, in the form of <code>dotnet new {shortName}</code>.</p>

<p>Customize the JSON fields to your liking and save the result. With that file in place, we can load our template into the .NET Core SDK with a single command.</p>

<!-- language: bash -->

<pre><code>dotnet new --install .
</code></pre>

<p>This command will install the current directory (<code>.</code>) as a template. If your command line&#8217;s current directory is somewhere other than the template, adjust accordingly.</p>

<p>Once you have your template installed, you should see it show up in the list with <code>dotnet new --list</code>. (It also should have output the list after successfully installing the template.)</p>

<!-- language: output -->

<pre><code>Templates                                                       Short Name          Language        Tags
--------------------------------------------------------------------------------------------------------------------------
Console Application                                             console             [C#], F#, VB    Common/Console
…
Our slightly modified console app                               console-awesome                     Console
</code></pre>

<p>With our custom template in the list, we can generate a new version of our modified console app now.</p>

<!-- language: bash -->

<pre><code>dotnet new console-awesome --output ../MyNewAwesomeConsoleApp
</code></pre>

<p>This will generate a console app from our template in a sibling folder to our template folder. If you wish to generate the console app elsewhere, adjust the path provided to the <code>--output</code> parameter.</p>

<p>Look for your modified line(s) to verify everything generated as expected.</p>

<p>Technically, we have taken a fairly complex template we know nothing about internally and turned it into a completely static template. That&#8217;s progress, right? We&#8217;ll work on making our templates customizable another time.</p>

<h2>Other installation options</h2>

<p>The <code>dotnet new --install</code> command can accept a path to a folder, as we are providing here. It can also accept a path to a local NuGet package (.nupkg) or even a NuGet package ID from nuget.org. For example, I’m working on some templates to help with creating new template and adding files to Git/GitHub repos. This command would install those templates from NuGet directly.</p>

<!-- language: bash -->

<pre><code>dotnet new --install dotnet_new_template_creator
</code></pre>

<p>Once you have a template you want to share with folks, you can wrap it up in a nupkg file and send it to them directly or via publishing it to nuget.org.</p>

<h2>[optional] Uninstalling your template</h2>

<p>I won&#8217;t pretend this new custom template is incredibly useful, so let&#8217;s make sure we can clean up our test efforts from the <code>dotnet new</code> options. If you install a template from a folder location, you uninstall it from an absolute path to that folder location using <code>dotnet new --uninstall</code>. For example, if I was working at <code>~/Projects/</code>, my uninstall command would be the absolute form of that path and look like this, with your username instead of <code>{username}</code>.</p>

<!-- language: bash -->

<pre><code>dotnet new --uninstall "/Users/{username}/Projects/MyConsoleApp"
</code></pre>

<p>If you installed a template from a nupkg or NuGet directly, you pass in the package ID. And, if you are ever unsure how a template was installed, you can get a list of all the valid uninstall parameters with an empty <code>--uninstall</code> command.</p>

<!-- language: bash -->

<pre><code>dotnet new --uninstall
</code></pre>

<h2>Check your work</h2>

<p>If you got lost along the way or need something to compare to, look in the <a href="https://github.com/patridge/demo-custom-dotnet-template/tree/master/1-custom-template"><strong>1-custom-template</strong> folder</a> of the <a href="https://github.com/patridge/demo-custom-dotnet-template">sample Git repo with the resulting templates</a> from following along with this blog post series.</p>

<h2>Next steps</h2>

<p>That’s the basics to getting started with your own <code>dotnet new</code> templates, but there are so many parts of the templating system that could have their own blog posts. In later posts, I’m hoping to explore some of the more complex features of the template config. If there’s something cool that I need to cover, <a href="https://twitter.com/patridgedev">reach out to me on Twitter: @patridgedev</a>.</p>
												</div><!-- .entry-content --> 
								<footer class="entry-meta2">
		<span class="bl_tagg">Tagged <a href="../../tag/template/index.html" rel="tag">template</a></span>
 									</footer><!-- #entry-meta -->

	</article><!-- #post-597 -->
	
	

				
					
	<article id="post-589" class="post-589 post type-post status-publish format-standard hentry category-dev tag-powershell">
		<header class="entry-header">	
			<h2 class="entry-title">
				<a href="../../2018/09/17/cleaning-up-unused-images-in-your-markdown-content/index.html" title="Permalink to Cleaning up unused images in your Markdown content with PowerShell" rel="bookmark">
					Cleaning up unused images in your Markdown content with PowerShell				</a>
			</h2>
						<div class="entry-meta">
				 <span class="author vcard" > By  <a class="url fn n" rel="author" href="../../author/adam/index.html" title="View all posts by adam">adam</a> <span class="bl_sep">|</span></span>  <time class="onDate date published" datetime="2018-09-17T08:00:06+00:00"> <a href="../../2018/09/17/cleaning-up-unused-images-in-your-markdown-content/index.html" title="8:00 am" rel="bookmark"><span class="entry-date">September 17, 2018</span> <span class="entry-time"> - 8:00 am</span></a> </time><span class="bl_sep">|</span><time class="updated"  datetime="2020-03-19T13:28:28+00:00">March 19, 2020</time> <span class="bl_categ"> <a href="../../category/dev/index.html" rel="tag">dev</a> </span>  							<div class="comments-link">
				<a href="../../2018/09/17/cleaning-up-unused-images-in-your-markdown-content/index.html#respond">Leave a comment</a>			</div>
						</div><!-- .entry-meta -->
			
		
		</header><!-- .entry-header -->
									<div class="entry-content">
						<p>I was recently tasked with cleaning up some Markdown content with a bunch of screenshots. Sometimes as content was revised, an image would no longer be used, but the image wasn&#8217;t deleted. As a result, the images folder would often be packed with files that were no longer used in the final Markdown content.</p>

<p>On a few blocks of content, I would do this manually in VS Code. From the file list (Ctrl+Shift+E), I’d select the file, copy the file name (F2, then Ctrl+C), search all the files for that file name (Ctrl+Shift+F, then Ctrl+V). This was painful to do for more than a few blocks, so I decided to turn to automation, Powershell in this case.</p>

<p>PowerShell is available on Windows and Linux/macOS, so it’s great for wherever I need it. It even seems to properly translate my path separators on different platforms.</p>

<h2>Getting the image file names</h2>

<p>There are a lot of aliases in PowerShell, they make some verbose commands either shorter and easier to remember, or they duplicate functionality found in the host system. For example, the <code>dir</code> command is available in PowerShell, but it is actually an alias for the <code>Get-ChildItem</code> command. (Please note that PowerShell commands are actually called &#8220;cmdlets&#8221;, just not here…sorry, not sorry.)</p>

<p>So, to get all the image file names I want to search for, I’ll need a variant of <code>Get-ChildItem</code>. In my case, these images were in a “media” folder.</p>

<!-- language: powershell -->

<pre><code>Get-ChildItem .\media\
</code></pre>

<p>This will list out my files, but let’s map the resulting objects into just the filename strings.</p>

<!-- language: powershell -->

<pre><code>Get-ChildItem .\media\ | ForEach { $_.Name }
</code></pre>

<p>Now, we “pipe” (<code>|</code>) the resulting <code>Get-ChildItem</code> file objects individually into the <code>ForEach-Object</code> command (or just <code>ForEach</code> as we used), and for each item, noted with <code>$_</code>, we grab the <code>Name</code> property to make sure we have just the filename and not the full file path.</p>

<h2>Searching a file for a string</h2>

<p>As a quick side-step, let’s figure out how to search a file for a particular string. In PowerShell, there is the <a href="https://docs.microsoft.com/en-us/powershell/module/microsoft.powershell.utility/select-string?view=powershell-6"><code>Select-String</code></a> command, which the docs say, &#8220;Finds text in strings and files.&#8221;  It can take a string and return the line containing the given <code>-Pattern</code> parameter. I won&#8217;t argue it&#8217;s the fastest or most accurate way to do text search in files, as I haven&#8217;t done any research on alternatives, but it works well enough for my use case.</p>

<!-- language: powershell -->

<pre><code>Select-String -Pattern "something awesome" -Path .\content\*.md
</code></pre>

<p>I&#8217;m not stressing this command too much. Select-String can do much more advanced stuff, especially if you need regular expressions.</p>

<h2>Combination: Find unused images</h2>

<p>With a list of image file names, I can now use another command to filter the list: <code>Where-Object</code> (or just <code>Where</code>). If you are familiar with C#, this is just like the <code>Where</code> function in LINQ. WIth any collection, you pass in a method that returns a boolean object. Anything that would return true on that method will make it into the resulting output.</p>

<p>In this case, for each image file name, I want to see if it <strong>doesn&#8217;t</strong> produce any results when run through <code>Select-String</code> on any of the Markdown files.</p>

<!-- language: powershell -->

<pre><code>Get-ChildItem .\media\ | Where { (Get-ChildItem .\includes\*.md | Select-String $_.Name).Count -eq 0 }
</code></pre>

<p>Things start to get a little nested here. We look for the name property of each image file within all the Markdown files (those with the <code>.md</code> extension), and only leave the ones with no matches (<code>.Count -eq 0</code>) to each one of the file names (<code>$_</code> of the <code>Where</code> method). Any image file name that makes it through was not mentioned in the Markdown content, which in my case, means it is fair game for deletion.</p>

<h2>Deleting a file</h2>

<p>With one last side-step, let&#8217;s figure out how to delete a file. In this situation, any image I have that isn&#8217;t referenced is bound for the trash.</p>

<!-- language: powershell -->

<pre><code>Remove-Item -Path .\media\some-image.png
</code></pre>

<p>The <code>Remove-Item</code> command will delete the item at the given path. That path can be a pattern or even a collection, which will be handy when I have a list of images I no longer want.</p>

<h2>Final combination: Deleting images unused in Markdown</h2>

<p>With all the commands and a little bit of piping them together, I can now assemble a command that will find all unused images and delete them immediately. In this case, we take the output of finding unused images, filter to just the fully-qualified path (<code>$_.FullName</code>) and pipe it directly into the <code>Remove-Item</code> command.</p>

<!-- language: powershell -->

<pre><code>Get-ChildItem .\media\ | Where { (Get-ChildItem .\includes\*.md | Select-String $_.Name).Count -eq 0 } | ForEach { $_.FullName } | Remove-Item
</code></pre>

<p>And with that, goodbye unused images.</p>
												</div><!-- .entry-content --> 
								<footer class="entry-meta2">
		<span class="bl_tagg">Tagged <a href="../../tag/powershell/index.html" rel="tag">PowerShell</a></span>
 									</footer><!-- #entry-meta -->

	</article><!-- #post-589 -->
	
	

				
					
	<article id="post-556" class="post-556 post type-post status-publish format-standard hentry category-dev tag-meta tag-wordpress">
		<header class="entry-header">	
			<h2 class="entry-title">
				<a href="../../2017/09/25/adding-https-to-wordpress-with-cloudflare/index.html" title="Permalink to Adding HTTPS to WordPress with Cloudflare" rel="bookmark">
					Adding HTTPS to WordPress with Cloudflare				</a>
			</h2>
						<div class="entry-meta">
				 <span class="author vcard" > By  <a class="url fn n" rel="author" href="../../author/adam/index.html" title="View all posts by adam">adam</a> <span class="bl_sep">|</span></span>  <time class="onDate date published" datetime="2017-09-25T08:30:46+00:00"> <a href="../../2017/09/25/adding-https-to-wordpress-with-cloudflare/index.html" title="8:30 am" rel="bookmark"><span class="entry-date">September 25, 2017</span> <span class="entry-time"> - 8:30 am</span></a> </time><span class="bl_sep">|</span><time class="updated"  datetime="2017-09-25T08:30:46+00:00">September 25, 2017</time> <span class="bl_categ"> <a href="../../category/dev/index.html" rel="tag">dev</a> </span>  							<div class="comments-link">
				<a href="../../2017/09/25/adding-https-to-wordpress-with-cloudflare/index.html#respond">Leave a comment</a>			</div>
						</div><!-- .entry-meta -->
			
		
		</header><!-- .entry-header -->
									<div class="entry-content">
						<p><img src="../../wp-content/uploads/2017/09/patridgedev-chrome-https-secure-and-happy.png" alt="patridgedev.com with a fancy green &quot;Secure&quot; padlock" /></p>

<p>With some helpful <a href="https://github.com/planetxamarin/planetxamarin/issues/334">pursuasion from Planet Xamarin</a>, I decided my blog needed to support HTTPS requests. I&#8217;ve wanted to find a way to support HTTPS traffic on my blog for a while, but I wanted to find a solution that would Just Work™ without me doing the leg work. I&#8217;ll stick to writing the blog posts and let someone else worry about hosting details.</p>

<p>Just like anything security-related, setting up SSL intimidates me a bit (more so because this often involves the dark magic of DNS records). I&#8217;ll do security when I have to, but my prerequisite is always that I read so much about the topic I feel comfortable explaining every decision I make to either an expert or someone completely unfamiliar with the topic.</p>

<h2>Encrypting patridgedev.com traffic</h2>

<p>This blog is currently a WordPress site on a host using AdminPanel. I have spent hours in IIS for ASP.NET sites, but almost nothing on Linux hosting. It&#8217;s all just me poking around hoping to find things. Fortunately, when it comes to SSL support, there are simple options that can bolt on to other hosting: specifically Let&#8217;s Encrypt certificates and Cloudflare&#8217;s secure proxy system.</p>

<p>Everything I looked into for Let&#8217;s Encrypt said to use the settings in AdminPanel, but that required some administrator management to enable. These are not my servers, so that was a no-go.</p>

<p>Cloudflare is a proxy between the world and my site that just happens to offer some mostly-automated, and free, SSL support. You give it a domain, it scans the DNS for that domain and creates a new DNS layer, with some requests going through their system before your servers see them. With those DNS records in Cloudflare&#8217;s system, you simply update your nameservers at your domain registrar, <a href="%e2%80%a6.html">Namecheap</a> for most of my domains. (Disclaimer: if you buy Namecheap services through that link, they&#8217;ll give me little bit as an affiliate.)</p>

<p>In doing this proxy dance through Cloudflare&#8217;s DNS, they can encrypt the connection between any web visitor and the Cloudflare servers. These servers then make requests to my existing servers and return the result through that encrypted connection, making patridgedev.com &#8220;support&#8221; HTTPS requests. You could argue that the connection isn&#8217;t yet encrypted end-to-end, which is true, but it&#8217;s way better than before where the connection could be compromised at any point from your computer to my servers.</p>

<p>There was zero downtime with this transition. My old DNS entries went away, and the new Cloudflare ones took over. Unfortunately, it also didn&#8217;t magically make my site SSL-awesome.</p>

<p><img src="../../wp-content/uploads/2017/09/patridgedev-https-but-broken-styles-and-scripts.png" alt="patridgedev.com with several mixed-security broken things making it render horribly in most browsers" /></p>

<h2>Making WordPress SSL-awesome</h2>

<p>You probably don&#8217;t want to stop here, as most browsers will block mixed content like this. If a malicious attacker can intercept your HTTP requests for the JavaScript on an HTTPS web site, they can do all sorts of nasty things (stealing authentication cookies, making requests on your [authenticated] behalf, changing content in subtle ways). You really do want the browser to prevent that for important sites, even if it means things break. For patridgedev.com, I just don&#8217;t want anyone to have such a bad experience on HTTPS, so I had to fix it.</p>

<p>Most of these issues were because links were still being fully qualified to <code>https://</code> inside WordPress. The simple solution to this was supposed to be setting the WordPress Address and Site Address to <code>https://www.patridgedev.com</code> under <strong>Settings</strong>><strong>General</strong>, but that didn&#8217;t seem to do anything for the site. In fact, it made it so my admin WordPress pages would get stuck in a redirect loop.</p>

<p><img src="../../wp-content/uploads/2017/09/wordpress-set-site-address.png" alt="Setting the WordPress and Site Address fields to HTTPS" /></p>

<p>Investigating with Chrome Developer Tools showed a request being made over HTTPS and an immediate redirect to the exact same HTTPS URL, meaning it wasn&#8217;t redirecting back and forth between two places as I first suspected. I didn&#8217;t have anything custom in an <strong>.htaccess</strong> file, so it wasn&#8217;t causing the redirects. The DNS settings didn&#8217;t have anything funky that would cause this, just normal A records for www and non-www. I even searched my site&#8217;s code for instances of <code>http:</code>, but that was a really noisy set of search results.</p>

<p>My searches for &#8220;WordPress too many redirects&#8221; were finding lots of potential suspects, but none seemed to apply to my site. Once I added &#8220;Cloudflare&#8221; into the search term, I stumbled on this <a href="https://stackoverflow.com/q/32642876/48700">Stack Overflow question where the original source appeared to have been having an .htaccess issue</a>. The question had one sad <a href="https://stackoverflow.com/a/38614655/48700">no-votes (at the time) answer</a> that turned out to be my magic bullet.</p>

<p>Inside WordPress is an <code>is_ssl</code> method that checks a couple <code>$_SERVER</code> variables to decide if the current request is using HTTPS and/or port 443, neither of which is technically true for HTTPS requests at that point. WordPress was not seeing HTTPS requests, because they really aren&#8217;t. The connection to Cloudflare is secure, but my site is seeing Cloudflare&#8217;s proxied requests via old-school port-80 HTTP.</p>

<p>This <code>is_ssl</code> method gets called all over the place to decide how to prefix fully-qualified URLs with a protocol. In order to get through that logic, we have to force the <code>$_SERVER['HTTPS']</code> variable to be true at the right time before that method is ever called. That&#8217;s exactly what the Stack Overflow answer establishes. We set up a little extra check in the site&#8217;s root <strong>wp-config.php</strong> file for a particular header seen on Cloudfare&#8217;s proxied requests hitting my site.</p>

<p><code>php
if (isset($_SERVER['HTTP_X_FORWARDED_PROTO']) &amp;&amp; $_SERVER['HTTP_X_FORWARDED_PROTO'] == 'https') {
    $_SERVER['HTTPS'] = 'on';
}</code></p>

<p>With that in place, we force the <code>HTTPS</code> variable to be <code>'on'</code> for these requests whenever <code>is_ssl</code> is later called for URL generation, resulting in much happiness. There were still a few non-SSL requests on my blog pages, most of which was my own doing.</p>

<h2>Cleaning up the last errors</h2>

<p>I had a few widget HTML blocks that were referring to HTTP content: an ancient Amazon affiliate script include, an old Stack Overflow profile badge image, an Apple App Store widget for <a href="https://pdev.co/smudges_ios">Smudges</a>, and a <em>lot</em> of embedded post images (and post cross-links). All said, it was just a visual find-and-replace job in WordPress. Only the Apple widget wasn&#8217;t as simple as adding an &#8220;s&#8221; to a URL.</p>

<p><img src="../../wp-content/uploads/2017/09/app-store-widget-smudges.png" alt="Apple add widget snapshot after HTTPS efforts" /></p>

<p>The App Store widget definitely doesn&#8217;t cooperate with a HTTPS page. Presumably, it is mishandling things on a secure connection. It&#8217;s especially evil since it seems to render fine, so the non-SSL request is totally unnecessary. Unfortunately, even the latest <a href="https://widgets.itunes.apple.com/"><code>iframe</code> HTML from Apple</a> hasn&#8217;t changed, so the error won&#8217;t go away.</p>

<p>It turns out that I had a tendency to be inconsistent when embedding images in my posts. While there are probably ways to do mass find-and-replace efforts in WordPress, I just opened all my posts individually and did the work there. It wasn&#8217;t as bad as it sounds; only a handful of posts had the domain hard-coded, and I haven&#8217;t written enough posts to feel intimidated by the count.</p>

<p>I probably still need to set up a forced redirect for non-SSL requests to be secure by default. This could also make sure search engines don&#8217;t see HTTP and HTTPS pages as different content, but I&#8217;ll work toward that another time, maybe when I finally get to rewriting this blog as a static-content site (e.g., Jekyll and GitHub Pages).</p>

<p>I&#8217;m hoping none of this will affect anyone reading blog posts here, but if you see anything looking unusual, <a href="https://twitter.com/patridgedev">drop me a line on Twitter</a>.</p>
												</div><!-- .entry-content --> 
								<footer class="entry-meta2">
		<span class="bl_tagg">Tagged <a href="../../tag/meta/index.html" rel="tag">meta</a>, <a href="../../tag/wordpress/index.html" rel="tag">wordpress</a></span>
 									</footer><!-- #entry-meta -->

	</article><!-- #post-556 -->
	
	

				
					
	<article id="post-546" class="post-546 post type-post status-publish format-standard hentry category-dev tag-c-sharp tag-netduino">
		<header class="entry-header">	
			<h2 class="entry-title">
				<a href="../../2017/09/11/return-of-netduino-net-on-small-hardware/index.html" title="Permalink to Return of Netduino, .NET on small hardware" rel="bookmark">
					Return of Netduino, .NET on small hardware				</a>
			</h2>
						<div class="entry-meta">
				 <span class="author vcard" > By  <a class="url fn n" rel="author" href="../../author/adam/index.html" title="View all posts by adam">adam</a> <span class="bl_sep">|</span></span>  <time class="onDate date published" datetime="2017-09-11T08:00:56+00:00"> <a href="../../2017/09/11/return-of-netduino-net-on-small-hardware/index.html" title="8:00 am" rel="bookmark"><span class="entry-date">September 11, 2017</span> <span class="entry-time"> - 8:00 am</span></a> </time><span class="bl_sep">|</span><time class="updated"  datetime="2017-09-11T08:00:56+00:00">September 11, 2017</time> <span class="bl_categ"> <a href="../../category/dev/index.html" rel="tag">dev</a> </span>  							<div class="comments-link">
				<a href="../../2017/09/11/return-of-netduino-net-on-small-hardware/index.html#comments">4 Comments</a>			</div>
						</div><!-- .entry-meta -->
			
		
		</header><!-- .entry-header -->
									<div class="entry-content">
						<p>A little piece of magic wandered into my Twitter feed recently. Between the Windows IoT stuff I messed with <a href="https://twitter.com/PatridgeDev/status/843113990519771140">this</a> <a href="https://twitter.com/PatridgeDev/status/844553311059693569">summer</a>, controlling LEDs via Xamarin.Forms, and this awesome news, I&#8217;m bound to be learning the hardware side of things a little better.</p>

<blockquote class="twitter-tweet"><p lang="nl" dir="ltr">Netduino is back! <a href="https://t.co/gU2CNIWFYE">https://t.co/gU2CNIWFYE</a></p>&mdash; Netduino (@netduino) <a href="https://twitter.com/netduino/status/888092844337971200">July 20, 2017</a></blockquote>

<script async src="https://platform.twitter.com/widgets.js" charset="utf-8"></script>

<p>That&#8217;s right, Netduino has returned; this time <a href="https://www.wildernesslabs.co/">Wilderness Labs</a> has taken the reins (with <a href="https://twitter.com/bryancostanich">Bryan Costanich</a> heading things up). Netduino is a hardware platform, similar to Arduino with lots of input and output options through a bunch of pins on the board, that allows interacting with it using .NET. Not only has Wilderness Labs resurrected Netduino, they have released three new boards: <a href="https://amzn.to/2wdBl0L">Netduino 3</a>, <a href="https://amzn.to/2xlJm3E">Netduino 3 Ethernet</a>, and <a href="https://amzn.to/2vfFmVb">Netduino 3 WiFi</a>.</p>

<p>According to the <a href="https://developer.wildernesslabs.co/Netduino/About/">Wilderness Labs Netduino docs</a>, these new boards are as fast as ever, all running Cortex-M4 processors at 168MHz, and with more flash storage and a bump in RAM: the base Netduino 3 has 384KB of flash (matching the old Netduino 2 Plus), and the Netduino 3 Ethernet and Netduino 3 WiFi both have a bump to 1,408KB. If it wasn&#8217;t obvious, the Netduino 3 Ethernet board also offers a 10/100 Ethernet port, and the Netduino 3 WiFi has an 802.11b/g/n wi-fi adapter. So, they are as fast as ever and with more resources to do what you tell them.</p>

<p>I have been interested in Netduino since I first heard about it, though I didn&#8217;t buy one to play with until the release of the prior Netduino 2 Plus. All I had ever done with that system was blink the on-board LED. A few hours after I read that tweet, I was digging through my box-o&#8217;-electronics until I found it. This time, I decided I would do something more useful, or at least more fun.</p>

<h2>Getting hardware rolling [again]</h2>

<p>Since I wasn&#8217;t entirely sure what firmware was installed on my Netduino, I decided to <a href="https://developer.wildernesslabs.co/Netduino/About/Updating_Firmware/">install the latest from Wilderness Labs</a>. I figured there was no sense in finding a bug that was fixed in the later firmware versions.</p>

<p>Unfortunately, every time I tried to flash the firmware on my MacBook, it would get stuck. After several unsuccessful attempts to debug the issue, I randomly ended up using a different USB cable. Everything flashed perfectly after that, and I tossed the defective USB cable. While it may not help with my faulty cable issue, <a href="https://twitter.com/chknofthescene">Alex Corrado</a> has since <a href="https://github.com/WildernessLabs/Netduino-Updater/pull/3">updated the error handling on the macOS firmware update tool</a>, so you may have not have as much trouble debugging issues by the time you read this.</p>

<h2>Getting an IDE rolling</h2>

<p>What little code I wrote the last time I did Netduino development was probably on Visual Studio 2013. While the Netduino Discord channel looks like Netduino is quickly moving to Visual Studio 2017 and Visual Studio for Mac, it&#8217;s not quite 100 percent there yet. So, I busted out my older MacBook with Xamarin Studio. (I could have also installed Visual Studio 2015, but having spent so much time with 2017&#8217;s more self-contained installs makes me not want to return to the previous era.)</p>

<p>Since I was going the Xamarin Studio route, I added the <a href="https://developer.wildernesslabs.co/Netduino/Getting_Started/"><strong>Micro Framework</strong> add-in/extension as instructed</a>. A quick restart of the IDE, and I was up and rolling, blinking the same LED I&#8217;d blinked a few years back.</p>

<h2>What&#8217;s next?</h2>

<p>I have played with a few sensors and LEDs already, and some more code-happy posts will be coming soon.</p>

<p>So far, I have a few random toys to play with: a water-resistant temperature sensor, a <a href="https://amzn.to/2viNF2v">BME280 temperature/pressure/altitude sensor</a>, and an ultrasonic range sensor</p>

<p>Even if the Netduino is overkill, I might start working on a small temperature-monitoring system feeding to Azure IoT Hub with an app front-end for our chicken coop. Or maybe a silly well-sensored aquaponics system. As much fun as blinking LEDs can be, what other semi-useful things should I be trying to make? Drop me a <a href="https://twitter.com/patridgedev">line on Twitter</a> if you have any suggestions.</p>
												</div><!-- .entry-content --> 
								<footer class="entry-meta2">
		<span class="bl_tagg">Tagged <a href="../../tag/c-sharp/index.html" rel="tag">c#</a>, <a href="../../tag/netduino/index.html" rel="tag">netduino</a></span>
 									</footer><!-- #entry-meta -->

	</article><!-- #post-546 -->
	
	

				
					<div class='pagination_container'><nav class='pagination'><a href='../../index.html'>&lsaquo;</a><a href='../../index.html' class='inactive' >1</a><span class='current'>2</span><a href='../3/index.html' class='inactive' >3</a><a href='../4/index.html' class='inactive' >4</a><a href='../3/index.html'>&rsaquo;</a><a href='../7/index.html'>&raquo;</a></nav></div>

			
			</div><!-- #content -->
			<div id="primary" class="widget-area" role="complementary">

		
		
			<ul class="xoxo">
				<li id="search-2" class="widget-container widget_search"><form method="get" id="searchform" action="https://www.patridgedev.com/">
	<label>
		<span class="screen-reader-text">Search for:</span>
		<input type="search" class="s" placeholder="Search" value="" name="s" />
	</label>
	<button type="submit" class="searchsubmit"><span class="screen-reader-text">Search</span>OK</button>
</form>
</li>		<li id="recent-posts-2" class="widget-container widget_recent_entries">		<h3 class="widget-title">Recent Posts</h3>		<ul>
											<li>
					<a href="../../2019/09/27/copy-command-line-output-to-the-clipboard-on-macos-windows-and-linux/index.html">Copy command line output to the clipboard on macOS, Windows, and Linux</a>
									</li>
											<li>
					<a href="../../2019/08/06/determine-sha-hash-of-file-on-windows-linux-and-macos/index.html">Determine SHA hash of file on Windows, Linux, and macOS</a>
									</li>
											<li>
					<a href="../../2019/05/20/workaround-xamarin-android-long-paths-on-windows/index.html">Workaround: Xamarin.Android long paths on Windows</a>
									</li>
											<li>
					<a href="../../2019/02/06/play-japanese-famicom-games-with-your-us-nintendo-switch-online-account/index.html">Play Japanese Famicom games with your US Nintendo Switch Online account</a>
									</li>
											<li>
					<a href="../../2018/10/29/fallback-variables-in-dotnet-new-templates/index.html">Fallback variables in `dotnet new` templates</a>
									</li>
					</ul>
		</li><li id="text-3" class="widget-container widget_text">			<div class="textwidget"><p><!--Amazon--><br />
<iframe src="https://web.archive.org/web/20190427210543if_/https://rcm-na.amazon-adsystem.com/e/cm?t=pricetrack-20&amp;o=1&amp;p=9&amp;l=ez&amp;f=ifr&amp;f=ifr&amp;linkID=U4QK3RSRY7VEZR26" scrolling="no" marginwidth="0" marginheight="0" border="0" frameborder="0" style="border:none;"></iframe></p>
</div>
		</li>			</ul>

			<ul class="xoxo">
				<li id="text-2" class="widget-container widget_text"><h3 class="widget-title">PatridgeDev elsewhere</h3>			<div class="textwidget"><p><a href="https://stackoverflow.com/users/48700/patridge"><br />
<img src="https://stackoverflow.com/users/flair/48700.png" width="208" height="58" alt="profile for patridge at Stack Overflow, Q&amp;A for professional and enthusiast programmers" title="profile for patridge at Stack Overflow, Q&amp;A for professional and enthusiast programmers"><br />
</a>
</div>
<div>
<a href="https://xamarin.com/mvp"><img src="../../wp-content/uploads/2015/04/MVP-Badge2-300x127.png" alt="Xamarin MVP" style="width:200px;"/></a>
</div>
<div>
<a href="https://university.xamarin.com/certification"><img src="../../wp-content/uploads/2015/04/Xamarin-Ceritified-Mobile-Developer-Badge-small-res.png" alt="Xamarin Certified Mobile Developer" style="width:150px;"/></a>
</div>
<div>
<a class="twitter-timeline" href="https://twitter.com/PatridgeDev" data-widget-id="349542841673973761">Tweets by @PatridgeDev</a><br />
<script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+"://platform.twitter.com/widgets.js";fjs.parentNode.insertBefore(js,fjs);}}(document,"script","twitter-wjs");</script></p>
</div>
		</li>			</ul>

			
		</div><!-- #primary .widget-area -->

			</section><!-- #container -->
	<div style="clear:both;"></div>

	</div> <!-- #forbottom -->
	</div><!-- #main -->


	<footer id="footer" role="contentinfo">
		<div id="colophon">
		
			

	<div id="footer-widget-area"  role="complementary"  class="footerone" >

	
			<div id="second" class="widget-area">
			<ul class="xoxo">
				<li id="text-5" class="widget-container widget_text">			<div class="textwidget"><div id="amzn-assoc-ad-d543690b-5196-4e42-ab6e-dc8f3891227e"></div>
<p><script async src="https://z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&amp;adInstanceId=d543690b-5196-4e42-ab6e-dc8f3891227e"></script></p>
</div>
		</li>			</ul>
		</div><!-- #second .widget-area -->
	
	
		
	</div><!-- #footer-widget-area -->
			
		</div><!-- #colophon -->

		<div id="footer2">
		
			<div style="text-align:center;clear:both;padding-top:4px;" >
	<a href="../../index.html" title="PatridgeDev" rel="home">
		PatridgeDev</a> | Powered by <a target="_blank" href="https://www.cryoutcreations.eu/mantra" title="Mantra Theme by Cryout Creations">Mantra</a> &amp; <a target="_blank" href="https://wordpress.org/"
		title="Semantic Personal Publishing Platform">  WordPress.	</a>
</div><!-- #site-info --> 	<div class="socials" id="sfooter"> 
	
			<a target="_blank" rel="nofollow" href="https://twitter.com/patridgedev" class="socialicons social-Twitter" title="Twitter">
				<img alt="Twitter" src="../../wp-content/themes/mantra.3.2.0_custom/resources/images/socials/Twitter.png" />
			</a>
            	</div>
				
		</div><!-- #footer2 -->

	</footer><!-- #footer -->

</div><!-- #wrapper -->

<script type='text/javascript' src='../../wp-includes/js/wp-embed.mine6b3.js?ver=5.4.11'></script>

</body>
</html>
